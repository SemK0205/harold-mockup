(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27612,e=>{"use strict";let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],27612)},28856,74050,e=>{"use strict";e.i(64566);var t=e.i(68834),s=e.i(79473);let r=(0,t.create)()((0,s.devtools)((0,s.persist)((e,t)=>({viewedDeals:new Set,viewedVersion:0,notificationPermission:"default",knownDealIds:new Set,markAsViewed:t=>{e(e=>{let s=new Set(e.viewedDeals);return s.add(t),{viewedDeals:s,viewedVersion:e.viewedVersion+1}})},isNewDeal:e=>{let s=t();return s.knownDealIds.has(e)&&!s.viewedDeals.has(e)},initNotificationPermission:()=>{"undefined"==typeof Notification?e({notificationPermission:"unsupported"}):e({notificationPermission:Notification.permission})},requestNotificationPermission:async()=>{if("undefined"==typeof Notification)return void e({notificationPermission:"unsupported"});try{let t=await Notification.requestPermission();e({notificationPermission:t})}catch(e){console.error("Failed to request notification permission:",e)}},showNotification:(e,s)=>{if("granted"===t().notificationPermission)try{new Notification(e,{icon:"/favicon.ico",badge:"/favicon.ico",...s})}catch(e){console.error("Failed to show notification:",e)}},setKnownDeals:s=>{let r=t();0===r.knownDealIds.size?e({knownDealIds:new Set(s),viewedDeals:new Set([...r.viewedDeals,...s])}):e({knownDealIds:new Set(s)})},addKnownDeal:s=>!t().knownDealIds.has(s)&&(e(e=>{let t=new Set(e.knownDealIds);return t.add(s),{knownDealIds:t}}),!0)}),{name:"harold-viewed-deals",storage:{getItem:e=>{let t=localStorage.getItem(e);if(!t)return null;try{let e=JSON.parse(t);return{state:{...e.state,viewedDeals:new Set(e.state.viewedDeals||[]),knownDealIds:new Set(e.state.knownDealIds||[])}}}catch{return null}},setItem:(e,t)=>{let s={state:{...t.state,viewedDeals:Array.from(t.state.viewedDeals||[]),knownDealIds:Array.from(t.state.knownDealIds||[])}};localStorage.setItem(e,JSON.stringify(s))},removeItem:e=>localStorage.removeItem(e)},partialize:e=>({viewedDeals:e.viewedDeals,knownDealIds:e.knownDealIds})}),{name:"notification-store"}));e.s(["default",0,r],74050),e.s([],28856)},48725,63209,76639,14764,84614,37727,14683,83086,88699,43531,45423,89271,96357,45747,83850,e=>{"use strict";let t,s,r;var a=e.i(43476),l=e.i(932),n=e.i(71645),i=e.i(3116),o=e.i(78583),c=e.i(69638),d=e.i(73884),u=e.i(75254);let m=(0,u.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>m],63209);var p=e.i(86311),g=e.i(21218);function x(e){let t,s,r,u,x,b,v,j,N,w,k,S,C,q,$,D,M,A,E,I,T,F,R,O,P,U,B,z,L,W,H,K,V,J,X,Y=(0,l.c)(77),{deals:Q,onDealClick:G}=e,[Z,ee]=(0,n.useState)("all"),[et,es]=(0,n.useState)("week");Y[0]!==Q?(t=[],Q.forEach(e=>{if(t.push({id:`${e.id}-created`,dealId:e.id,type:"created",timestamp:e.created_at,deal:e,title:`New Deal: ${e.vessel_name||"TBD"}`,description:`${e.customer_room_name} - ${e.port||"TBD"} - ${e.fuel_type||""} ${e.quantity||""}`,icon:(0,a.jsx)(o.FileText,{className:"w-4 h-4"}),color:"bg-blue-500"}),e.total_quotes_received>0&&e.last_quote_time&&t.push({id:`${e.id}-quoted`,dealId:e.id,type:"quoted",timestamp:e.last_quote_time,deal:e,title:`Quote Received: ${e.total_quotes_received}`,description:`${e.vessel_name||"TBD"} - ${e.customer_room_name}`,icon:(0,a.jsx)(p.MessageSquare,{className:"w-4 h-4"}),color:"bg-purple-500"}),e.closed_at){let s="closed_success"===e.status;t.push({id:`${e.id}-closed`,dealId:e.id,type:"closed",timestamp:e.closed_at,deal:e,title:s?`Deal Completed: $${e.final_price?.toLocaleString()||"0"}`:"cancelled"===e.status?"Deal Cancelled":"Deal Failed",description:s?`${e.selected_trader} - ${e.vessel_name||"TBD"}`:e.closing_reason||"No reason provided",icon:s?(0,a.jsx)(c.CheckCircle,{className:"w-4 h-4"}):"cancelled"===e.status?(0,a.jsx)(m,{className:"w-4 h-4"}):(0,a.jsx)(d.XCircle,{className:"w-4 h-4"}),color:s?"bg-green-500":"cancelled"===e.status?"bg-gray-500":"bg-red-500"})}}),t.sort(_),Y[0]=Q,Y[1]=t):t=Y[1];let er=t;if("all"!==Z){let e;Y[2]!==er||Y[3]!==Z?(e=er.filter(e=>e.deal.status===Z),Y[2]=er,Y[3]=Z,Y[4]=e):e=Y[4],er=e}Y[5]!==et?(s=(()=>{switch(et){case"today":{let e=new Date;return e.setHours(0,0,0,0),e}case"week":{let e=new Date;return e.setDate(e.getDate()-7),e}case"month":{let e=new Date;return e.setMonth(e.getMonth()-1),e}default:return null}})(),Y[5]=et,Y[6]=s):s=Y[6];let ea=s;if(ea){let e;Y[7]!==er||Y[8]!==ea?(e=er.filter(e=>new Date(e.timestamp)>=ea),Y[7]=er,Y[8]=ea,Y[9]=e):e=Y[9],er=e}let el=er;Y[10]!==el?(r={},el.forEach(e=>{let t=new Date(e.timestamp).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});r[t]||(r[t]=[]),r[t].push(e)}),Y[10]=el,Y[11]=r):r=Y[11];let en=r;Y[12]===Symbol.for("react.memo_cache_sentinel")?(u=["today","week","month","all"],Y[12]=u):u=Y[12],Y[13]!==et?(x=(0,a.jsx)("div",{className:"flex gap-2",children:u.map(e=>(0,a.jsx)("button",{onClick:()=>es(e),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${et===e?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"today"===e?"Today":"week"===e?"1 Week":"month"===e?"1 Month":"All"},e))}),Y[13]=et,Y[14]=x):x=Y[14],Y[15]===Symbol.for("react.memo_cache_sentinel")?(b=()=>ee("all"),Y[15]=b):b=Y[15];let ei=`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${"all"===Z?"bg-gray-700 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`;Y[16]!==ei?(v=(0,a.jsx)("button",{onClick:b,className:ei,children:"All"}),Y[16]=ei,Y[17]=v):v=Y[17],Y[18]===Symbol.for("react.memo_cache_sentinel")?(j=()=>ee("active"),Y[18]=j):j=Y[18];let eo=`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${"active"===Z?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`;Y[19]!==eo?(N=(0,a.jsx)("button",{onClick:j,className:eo,children:"In Progress"}),Y[19]=eo,Y[20]=N):N=Y[20],Y[21]===Symbol.for("react.memo_cache_sentinel")?(w=()=>ee("closed_success"),Y[21]=w):w=Y[21];let ec=`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${"closed_success"===Z?"bg-green-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`;Y[22]!==ec?(k=(0,a.jsx)("button",{onClick:w,className:ec,children:"Completed"}),Y[22]=ec,Y[23]=k):k=Y[23],Y[24]===Symbol.for("react.memo_cache_sentinel")?(S=()=>ee("closed_lost"),Y[24]=S):S=Y[24];let ed=`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${"closed_lost"===Z?"bg-red-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`;return Y[25]!==ed?(C=(0,a.jsx)("button",{onClick:S,className:ed,children:"Failed"}),Y[25]=ed,Y[26]=C):C=Y[26],Y[27]!==k||Y[28]!==C||Y[29]!==v||Y[30]!==N?(q=(0,a.jsxs)("div",{className:"flex gap-2",children:[v,N,k,C]}),Y[27]=k,Y[28]=C,Y[29]=v,Y[30]=N,Y[31]=q):q=Y[31],Y[32]!==q||Y[33]!==x?($=(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[x,q]}),Y[32]=q,Y[33]=x,Y[34]=$):$=Y[34],Y[35]!==el.length?(D=(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:el.length}),Y[35]=el.length,Y[36]=D):D=Y[36],Y[37]===Symbol.for("react.memo_cache_sentinel")?(M=(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Total Events"}),Y[37]=M):M=Y[37],Y[38]!==D?(A=(0,a.jsxs)("div",{children:[D,M]}),Y[38]=D,Y[39]=A):A=Y[39],Y[40]!==el?(E=el.filter(y),Y[40]=el,Y[41]=E):E=Y[41],Y[42]!==E.length?(I=(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:E.length}),Y[42]=E.length,Y[43]=I):I=Y[43],Y[44]===Symbol.for("react.memo_cache_sentinel")?(T=(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"New Deals"}),Y[44]=T):T=Y[44],Y[45]!==I?(F=(0,a.jsxs)("div",{children:[I,T]}),Y[45]=I,Y[46]=F):F=Y[46],Y[47]!==el?(R=el.filter(f),Y[47]=el,Y[48]=R):R=Y[48],Y[49]!==R.length?(O=(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:R.length}),Y[49]=R.length,Y[50]=O):O=Y[50],Y[51]===Symbol.for("react.memo_cache_sentinel")?(P=(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Quotes"}),Y[51]=P):P=Y[51],Y[52]!==O?(U=(0,a.jsxs)("div",{children:[O,P]}),Y[52]=O,Y[53]=U):U=Y[53],Y[54]!==el?(B=el.filter(h),Y[54]=el,Y[55]=B):B=Y[55],Y[56]!==B.length?(z=(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:B.length}),Y[56]=B.length,Y[57]=z):z=Y[57],Y[58]===Symbol.for("react.memo_cache_sentinel")?(L=(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Completed"}),Y[58]=L):L=Y[58],Y[59]!==z?(W=(0,a.jsxs)("div",{children:[z,L]}),Y[59]=z,Y[60]=W):W=Y[60],Y[61]!==A||Y[62]!==F||Y[63]!==U||Y[64]!==W?(H=(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-4 gap-4 text-center",children:[A,F,U,W]}),Y[61]=A,Y[62]=F,Y[63]=U,Y[64]=W,Y[65]=H):H=Y[65],Y[66]!==$||Y[67]!==H?(K=(0,a.jsxs)("div",{className:"bg-white rounded-lg border p-4",children:[$,H]}),Y[66]=$,Y[67]=H,Y[68]=K):K=Y[68],Y[69]!==en||Y[70]!==G?(V=0===Object.keys(en).length?(0,a.jsx)("div",{className:"p-12 text-center text-gray-400",children:"No events match the selected criteria"}):Object.entries(en).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"border-b last:border-b-0",children:[(0,a.jsx)("div",{className:"px-4 py-2 bg-gray-50 border-b",children:(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:t})}),(0,a.jsx)("div",{className:"divide-y",children:s.map(e=>(0,a.jsx)("div",{onClick:()=>G?.(e.deal),className:"px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:`w-8 h-8 rounded-full ${e.color} text-white flex items-center justify-center flex-shrink-0 mt-0.5`,children:e.icon}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-0.5",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.deal.port&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(g.Activity,{className:"w-3 h-3"}),e.deal.port]}),e.deal.total_quotes_received>0&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(p.MessageSquare,{className:"w-3 h-3"}),e.deal.total_quotes_received," quotes"]}),e.deal.duration_minutes>0&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(i.Clock,{className:"w-3 h-3"}),Math.floor(e.deal.duration_minutes/60),"h"," ",Math.floor(e.deal.duration_minutes%60),"m"]})]})]}),(0,a.jsx)("span",{className:"text-xs text-gray-400 flex-shrink-0",children:function(e){let t=new Date(e),s=new Date().getTime()-t.getTime(),r=Math.floor(s/6e4),a=Math.floor(s/36e5),l=Math.floor(s/864e5);return r<1?"Just now":r<60?`${r}m ago`:a<24?`${a}h ago`:l<7?`${l}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}(e.timestamp)})]})})]})},e.id))})]},t)}),Y[69]=en,Y[70]=G,Y[71]=V):V=Y[71],Y[72]!==V?(J=(0,a.jsx)("div",{className:"bg-white rounded-lg border",children:V}),Y[72]=V,Y[73]=J):J=Y[73],Y[74]!==K||Y[75]!==J?(X=(0,a.jsxs)("div",{className:"space-y-4",children:[K,J]}),Y[74]=K,Y[75]=J,Y[76]=X):X=Y[76],X}function h(e){return"closed"===e.type&&"closed_success"===e.deal.status}function f(e){return"quoted"===e.type}function y(e){return"created"===e.type}function _(e,t){return new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()}e.s(["DealTimeline",()=>x],48725);var b=e.i(81140),v=e.i(20783),j=e.i(30030),N=e.i(10772),w=e.i(69340),k=e.i(26330),S=e.i(65491),C=e.i(74606),q=e.i(96626),$=e.i(48425),D=e.i(3536),M=e.i(85369),A=e.i(86312),E=Symbol("radix.slottable");function I(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===E}var T="Dialog",[F,R]=(0,j.createContextScope)(T),[O,P]=F(T),U=e=>{let{__scopeDialog:t,children:s,open:r,defaultOpen:l,onOpenChange:i,modal:o=!0}=e,c=n.useRef(null),d=n.useRef(null),[u,m]=(0,w.useControllableState)({prop:r,defaultProp:l??!1,onChange:i,caller:T});return(0,a.jsx)(O,{scope:t,triggerRef:c,contentRef:d,contentId:(0,N.useId)(),titleId:(0,N.useId)(),descriptionId:(0,N.useId)(),open:u,onOpenChange:m,onOpenToggle:n.useCallback(()=>m(e=>!e),[m]),modal:o,children:s})};U.displayName=T;var B="DialogTrigger";n.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,l=P(B,s),n=(0,v.useComposedRefs)(t,l.triggerRef);return(0,a.jsx)($.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":en(l.open),...r,ref:n,onClick:(0,b.composeEventHandlers)(e.onClick,l.onOpenToggle)})}).displayName=B;var z="DialogPortal",[L,W]=F(z,{forceMount:void 0}),H=e=>{let{__scopeDialog:t,forceMount:s,children:r,container:l}=e,i=P(z,t);return(0,a.jsx)(L,{scope:t,forceMount:s,children:n.Children.map(r,e=>(0,a.jsx)(q.Presence,{present:s||i.open,children:(0,a.jsx)(C.Portal,{asChild:!0,container:l,children:e})}))})};H.displayName=z;var K="DialogOverlay",V=n.forwardRef((e,t)=>{let s=W(K,e.__scopeDialog),{forceMount:r=s.forceMount,...l}=e,n=P(K,e.__scopeDialog);return n.modal?(0,a.jsx)(q.Presence,{present:r||n.open,children:(0,a.jsx)(X,{...l,ref:t})}):null});V.displayName=K;var J=((r=n.forwardRef((e,t)=>{let{children:s,...r}=e;if(n.isValidElement(s)){var a;let e,l,i=(a=s,(l=(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.ref:(l=(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.props.ref:a.props.ref||a.ref),o=function(e,t){let s={...t};for(let r in t){let a=e[r],l=t[r];/^on[A-Z]/.test(r)?a&&l?s[r]=(...e)=>{let t=l(...e);return a(...e),t}:a&&(s[r]=a):"style"===r?s[r]={...a,...l}:"className"===r&&(s[r]=[a,l].filter(Boolean).join(" "))}return{...e,...s}}(r,s.props);return s.type!==n.Fragment&&(o.ref=t?(0,v.composeRefs)(t,i):i),n.cloneElement(s,o)}return n.Children.count(s)>1?n.Children.only(null):null})).displayName="DialogOverlay.RemoveScroll.SlotClone",t=r,(s=n.forwardRef((e,s)=>{let{children:r,...l}=e,i=n.Children.toArray(r),o=i.find(I);if(o){let e=o.props.children,r=i.map(t=>t!==o?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(t,{...l,ref:s,children:n.isValidElement(e)?n.cloneElement(e,void 0,r):null})}return(0,a.jsx)(t,{...l,ref:s,children:r})})).displayName="DialogOverlay.RemoveScroll.Slot",s),X=n.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,l=P(K,s);return(0,a.jsx)(M.RemoveScroll,{as:J,allowPinchZoom:!0,shards:[l.contentRef],children:(0,a.jsx)($.Primitive.div,{"data-state":en(l.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),Y="DialogContent",Q=n.forwardRef((e,t)=>{let s=W(Y,e.__scopeDialog),{forceMount:r=s.forceMount,...l}=e,n=P(Y,e.__scopeDialog);return(0,a.jsx)(q.Presence,{present:r||n.open,children:n.modal?(0,a.jsx)(G,{...l,ref:t}):(0,a.jsx)(Z,{...l,ref:t})})});Q.displayName=Y;var G=n.forwardRef((e,t)=>{let s=P(Y,e.__scopeDialog),r=n.useRef(null),l=(0,v.useComposedRefs)(t,s.contentRef,r);return n.useEffect(()=>{let e=r.current;if(e)return(0,A.hideOthers)(e)},[]),(0,a.jsx)(ee,{...e,ref:l,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,b.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),s.triggerRef.current?.focus()}),onPointerDownOutside:(0,b.composeEventHandlers)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,s=0===t.button&&!0===t.ctrlKey;(2===t.button||s)&&e.preventDefault()}),onFocusOutside:(0,b.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault())})}),Z=n.forwardRef((e,t)=>{let s=P(Y,e.__scopeDialog),r=n.useRef(!1),l=n.useRef(!1);return(0,a.jsx)(ee,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(r.current||s.triggerRef.current?.focus(),t.preventDefault()),r.current=!1,l.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(l.current=!0));let a=t.target;s.triggerRef.current?.contains(a)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&l.current&&t.preventDefault()}})}),ee=n.forwardRef((e,t)=>{let{__scopeDialog:s,trapFocus:r,onOpenAutoFocus:l,onCloseAutoFocus:i,...o}=e,c=P(Y,s),d=n.useRef(null),u=(0,v.useComposedRefs)(t,d);return(0,D.useFocusGuards)(),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.FocusScope,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:l,onUnmountAutoFocus:i,children:(0,a.jsx)(k.DismissableLayer,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":en(c.open),...o,ref:u,onDismiss:()=>c.onOpenChange(!1)})}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ed,{titleId:c.titleId}),(0,a.jsx)(eu,{contentRef:d,descriptionId:c.descriptionId})]})]})}),et="DialogTitle",es=n.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,l=P(et,s);return(0,a.jsx)($.Primitive.h2,{id:l.titleId,...r,ref:t})});es.displayName=et;var er="DialogDescription";n.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,l=P(er,s);return(0,a.jsx)($.Primitive.p,{id:l.descriptionId,...r,ref:t})}).displayName=er;var ea="DialogClose",el=n.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,l=P(ea,s);return(0,a.jsx)($.Primitive.button,{type:"button",...r,ref:t,onClick:(0,b.composeEventHandlers)(e.onClick,()=>l.onOpenChange(!1))})});function en(e){return e?"open":"closed"}el.displayName=ea;var ei="DialogTitleWarning",[eo,ec]=(0,j.createContext)(ei,{contentName:Y,titleName:et,docsSlug:"dialog"}),ed=({titleId:e})=>{let t=ec(ei),s=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return n.useEffect(()=>{e&&(document.getElementById(e)||console.error(s))},[s,e]),null},eu=({contentRef:e,descriptionId:t})=>{let s=ec("DialogDescriptionWarning"),r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${s.contentName}}.`;return n.useEffect(()=>{let s=e.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null};let em=(0,u.default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var ep=e.i(75157);function eg(e){let t,s,r=(0,l.c)(4);return r[0]!==e?({...t}=e,r[0]=e,r[1]=t):t=r[1],r[2]!==t?(s=(0,a.jsx)(U,{"data-slot":"dialog",...t}),r[2]=t,r[3]=s):s=r[3],s}function ex(e){let t,s,r=(0,l.c)(4);return r[0]!==e?({...t}=e,r[0]=e,r[1]=t):t=r[1],r[2]!==t?(s=(0,a.jsx)(H,{"data-slot":"dialog-portal",...t}),r[2]=t,r[3]=s):s=r[3],s}function eh(e){let t,s,r,n,i=(0,l.c)(8);return i[0]!==e?({className:t,...s}=e,i[0]=e,i[1]=t,i[2]=s):(t=i[1],s=i[2]),i[3]!==t?(r=(0,ep.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),i[3]=t,i[4]=r):r=i[4],i[5]!==s||i[6]!==r?(n=(0,a.jsx)(V,{"data-slot":"dialog-overlay",className:r,...s}),i[5]=s,i[6]=r,i[7]=n):n=i[7],n}function ef(e){let t,s,r,n,i,o,c,d,u=(0,l.c)(15);u[0]!==e?({className:s,children:t,showCloseButton:n,...r}=e,u[0]=e,u[1]=t,u[2]=s,u[3]=r,u[4]=n):(t=u[1],s=u[2],r=u[3],n=u[4]);let m=void 0===n||n;return u[5]===Symbol.for("react.memo_cache_sentinel")?(i=(0,a.jsx)(eh,{}),u[5]=i):i=u[5],u[6]!==s?(o=(0,ep.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200",s),u[6]=s,u[7]=o):o=u[7],u[8]!==m?(c=m&&(0,a.jsxs)(el,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(em,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),u[8]=m,u[9]=c):c=u[9],u[10]!==t||u[11]!==r||u[12]!==o||u[13]!==c?(d=(0,a.jsxs)(ex,{"data-slot":"dialog-portal",children:[i,(0,a.jsxs)(Q,{"data-slot":"dialog-content","aria-describedby":void 0,className:o,...r,children:[t,c]})]}),u[10]=t,u[11]=r,u[12]=o,u[13]=c,u[14]=d):d=u[14],d}function ey(e){let t,s,r,n,i=(0,l.c)(8);return i[0]!==e?({className:t,...s}=e,i[0]=e,i[1]=t,i[2]=s):(t=i[1],s=i[2]),i[3]!==t?(r=(0,ep.cn)("flex flex-col gap-2 text-center sm:text-left",t),i[3]=t,i[4]=r):r=i[4],i[5]!==s||i[6]!==r?(n=(0,a.jsx)("div",{"data-slot":"dialog-header",className:r,...s}),i[5]=s,i[6]=r,i[7]=n):n=i[7],n}function e_(e){let t,s,r,n,i=(0,l.c)(8);return i[0]!==e?({className:t,...s}=e,i[0]=e,i[1]=t,i[2]=s):(t=i[1],s=i[2]),i[3]!==t?(r=(0,ep.cn)("text-lg leading-none font-semibold",t),i[3]=t,i[4]=r):r=i[4],i[5]!==s||i[6]!==r?(n=(0,a.jsx)(es,{"data-slot":"dialog-title",className:r,...s}),i[5]=s,i[6]=r,i[7]=n):n=i[7],n}e.s(["Dialog",()=>eg,"DialogContent",()=>ef,"DialogHeader",()=>ey,"DialogTitle",()=>e_],76639);let eb=(0,u.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>eb],14764);let ev=(0,u.default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>ev],84614),e.s(["X",()=>em],37727);var ej=e.i(60434);e.s(["Circle",()=>ej.default],14683);let eN=(0,u.default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);e.s(["Sparkles",()=>eN],83086);let ew=(0,u.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["Pencil",()=>ew],88699);var ek=e.i(78745);e.s(["Check",()=>ek.default],43531);let eS=(0,u.default)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);function eC(e,t,s){let r=[],a=s?.quote,l=s?.status,n="renegotiating"===l;return"no_offer"!==l&&!n&&("waiting_quote"===l||"quote_received"===l||"quote_collecting"===e||"deal_started"===e)&&(r.push({key:"fuel1_price",label:"Fuel1 Price",label_ko:"유종1 가격",required:!0,filled:!!a?.fuel1_price,value:a?.fuel1_price}),t>=2&&r.push({key:"fuel2_price",label:"Fuel2 Price",label_ko:"유종2 가격",required:!0,filled:!!a?.fuel2_price,value:a?.fuel2_price}),t>=3&&r.push({key:"fuel3_price",label:"Fuel3 Price",label_ko:"유종3 가격",required:!0,filled:!!a?.fuel3_price,value:a?.fuel3_price}),r.push({key:"barge_fee",label:"Barge Fee",label_ko:"바지선 비용",required:!1,filled:!!a?.barge_fee,value:a?.barge_fee}),r.push({key:"earliest",label:"Earliest",label_ko:"얼리",required:!0,filled:!!s?.earliest,value:s?.earliest||void 0}),r.push({key:"supplier",label:"Supplier",label_ko:"정유사",required:!1,filled:!!a?.supplier,value:a?.supplier}),r.push({key:"term",label:"Term",label_ko:"결제조건",required:!1,filled:!!a?.term,value:a?.term}),r.push({key:"fuel1_margin",label:"Fuel1 Margin",label_ko:"유종1 마진",required:!1,filled:!!a?.fuel1_margin,value:a?.fuel1_margin}),t>=2&&r.push({key:"fuel2_margin",label:"Fuel2 Margin",label_ko:"유종2 마진",required:!1,filled:!!a?.fuel2_margin,value:a?.fuel2_margin})),n&&(r.push({key:"fuel1_price",label:"Fuel1 Price",label_ko:"유종1 가격",required:!0,filled:!!a?.fuel1_price,value:a?.fuel1_price}),t>=2&&r.push({key:"fuel2_price",label:"Fuel2 Price",label_ko:"유종2 가격",required:!0,filled:!!a?.fuel2_price,value:a?.fuel2_price}),r.push({key:"barge_fee",label:"Barge Fee",label_ko:"바지선 비용",required:!1,filled:!!a?.barge_fee,value:a?.barge_fee}),r.push({key:"earliest",label:"Earliest",label_ko:"얼리",required:!0,filled:!!s?.earliest,value:s?.earliest||void 0}),r.push({key:"supplier",label:"Supplier",label_ko:"정유사",required:!1,filled:!!a?.supplier,value:a?.supplier}),r.push({key:"term",label:"Term",label_ko:"결제조건",required:!1,filled:!!a?.term,value:a?.term}),r.push({key:"fuel1_margin",label:"Fuel1 Margin",label_ko:"유종1 마진",required:!1,filled:!!a?.fuel1_margin,value:a?.fuel1_margin}),t>=2&&r.push({key:"fuel2_margin",label:"Fuel2 Margin",label_ko:"유종2 마진",required:!1,filled:!!a?.fuel2_margin,value:a?.fuel2_margin})),"seller_feedback"===e&&(r.push({key:"fuel1_price",label:"New Fuel1 Price",label_ko:"새 유종1 가격",required:!1,filled:!!a?.fuel1_price,value:a?.fuel1_price}),t>=2&&r.push({key:"fuel2_price",label:"New Fuel2 Price",label_ko:"새 유종2 가격",required:!1,filled:!!a?.fuel2_price,value:a?.fuel2_price}),r.push({key:"barge_fee",label:"Barge Fee",label_ko:"바지선 비용",required:!1,filled:!!a?.barge_fee,value:a?.barge_fee})),r}function eq(e){let t=e.filter(e=>e.filled).length;return{filled:t,total:e.length,percentage:e.length>0?Math.round(t/e.length*100):100}}e.s(["Bell",()=>eS],45423),e.s(["getFieldCompletionRatio",()=>eq,"getSellerRequiredFields",()=>eC],89271);var e$=e.i(64566);let eD=(0,n.createContext)(void 0);function eM({children:e,session:t}){let[s,r]=(0,n.useState)(t);(0,n.useEffect)(()=>{r(t),c([]),_([]),f(null),u([]),p(new Set),x(0)},[t?.session_id]);let[l,i]=(0,n.useState)({buyer:{width:25,minWidth:20,maxWidth:35},ai:{width:40,minWidth:30,maxWidth:50},seller:{width:35,minWidth:25,maxWidth:45}}),[o,c]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[m,p]=(0,n.useState)(new Set),[g,x]=(0,n.useState)(0),[h,f]=(0,n.useState)(null),[y,_]=(0,n.useState)([]),[b,v]=(0,n.useState)(new Map),j=(0,e$.default)(e=>s?.session_id?e.sellerContextsBySession.get(s.session_id):void 0);(0,n.useEffect)(()=>{if(!s?.session_id)return;let e=j||s?.seller_contexts;if(!e)return;let t=Object.keys(e);0!==t.length&&(_(e=>{let s=t.filter(t=>!e.includes(t));return 0===s.length?e:(console.log("[DealModalContext] Adding new seller tabs from seller_contexts:",s),[...e,...s])}),f(e=>e||t[0]||null))},[s?.session_id,j,s?.seller_contexts]);let[N,w]=(0,n.useState)(!1),[k,S]=(0,n.useState)(!0),[C,q]=(0,n.useState)(new Map),$=(0,n.useCallback)(e=>C.get(e)||"com.kakao.talk",[C]),D=(0,n.useCallback)((e,t)=>{i(s=>{let r={...s},a=r[e],l=Math.max(a.minWidth,Math.min(a.maxWidth,t));r[e]={...a,width:l};let n=100-l;if("buyer"===e){let e=s.ai.width/(s.ai.width+s.seller.width);r.ai.width=n*e,r.seller.width=n*(1-e)}else if("ai"===e){let e=s.buyer.width/(s.buyer.width+s.seller.width);r.buyer.width=n*e,r.seller.width=n*(1-e)}else{let e=s.buyer.width/(s.buyer.width+s.ai.width);r.buyer.width=n*e,r.ai.width=n*(1-e)}return r})},[]),M=(0,n.useCallback)(e=>{r(t=>t?{...t,...e}:t)},[]),A=(0,n.useCallback)(e=>{c(t=>t.some(t=>t.message_id===e.message_id)?t:[...t,e])},[]),E=(0,n.useCallback)(e=>{p(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),I=(0,n.useCallback)(e=>{_(t=>t.includes(e)?t:[...t,e]),b.has(e)||v(t=>new Map(t).set(e,[])),h||f(e)},[h,b]),T=(0,n.useCallback)(e=>{_(t=>t.filter(t=>t!==e)),v(t=>{let s=new Map(t);return s.delete(e),s}),h===e&&f(y.find(t=>t!==e)||null)},[h,y]),F=(0,n.useCallback)((e,t)=>{v(s=>{let r=new Map(s);return r.set(e,t),r})},[]),R=(0,n.useCallback)((e,t)=>{v(s=>{let r=new Map(s),a=r.get(e)||[];return a.some(e=>e.message_id===t.message_id)||r.set(e,[...a,t]),r})},[]),O=(0,n.useMemo)(()=>({session:s,setSession:r,updateSession:M,columns:l,resizeColumn:D,buyerMessages:o,setBuyerMessages:c,addBuyerMessage:A,aiSuggestions:d,setAiSuggestions:u,selectedSuggestions:m,toggleSuggestion:E,fullContextCompletion:g,setFullContextCompletion:x,activeSellerTab:h,setActiveSellerTab:f,sellerTabs:y,addSellerTab:I,removeSellerTab:T,sellerMessages:b,setSellerMessagesForTrader:F,addSellerMessage:R,isResizing:N,setIsResizing:w,showAIPanel:k,setShowAIPanel:S,roomPlatforms:C,setRoomPlatforms:q,getRoomPlatform:$}),[s,M,l,D,o,A,d,m,E,g,h,y,I,T,b,F,R,N,k,C,$]);return(0,a.jsx)(eD.Provider,{value:O,children:e})}function eA(){let e=(0,n.useContext)(eD);if(void 0===e)throw Error("useDealModal must be used within a DealModalProvider");return e}e.s(["DealModalProvider",()=>eM,"useDealModal",()=>eA],96357);var eE=e.i(47167),eI=e.i(61238);class eT{static instance;eventSource=null;messageListeners=new Map;connectionListeners=new Set;processedMessages=new Set;reconnectTimer=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;RECONNECT_DELAY=3e3;isConnected=!1;apiUrl;constructor(){this.apiUrl=eE.default.env.NEXT_PUBLIC_API_URL||"http://localhost:59234"}static getInstance(){return eT.instance||(eT.instance=new eT),eT.instance}connect(){if(this.eventSource?.readyState===EventSource.OPEN)return void console.log("[SSE Manager] Already connected");this.cleanup(),console.log("[SSE Manager] Connecting to SSE...");try{let e=(0,eI.getApiUrl)();this.eventSource=new EventSource(`${e}/sse/messages`),this.eventSource.addEventListener("connected",()=>{console.log("[SSE Manager] Connected successfully"),this.isConnected=!0,this.reconnectAttempts=0,this.notifyConnectionListeners(!0)}),this.eventSource.addEventListener("new_message",e=>{try{let t=JSON.parse(e.data);if(this.processedMessages.has(t.id||t.message_id))return;this.processedMessages.add(t.id||t.message_id);let s={message_id:t.id||t.message_id,room_name:t.room_name,sender:t.sender,message:t.message,timestamp:t.created_at,package_name:t.platform||"com.kakao.talk",direction:"incoming",created_at:t.created_at};this.notifyMessageListeners(t.room_name,s)}catch(e){console.error("[SSE Manager] Failed to parse message:",e)}}),this.eventSource.addEventListener("heartbeat",()=>{}),this.eventSource.onerror=e=>{console.error("[SSE Manager] Connection error:",e),this.handleError()}}catch(e){console.error("[SSE Manager] Failed to create EventSource:",e),this.handleError()}}handleError(){this.isConnected=!1,this.notifyConnectionListeners(!1),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.reconnectAttempts<this.MAX_RECONNECT_ATTEMPTS?(this.reconnectAttempts++,console.log(`[SSE Manager] Reconnecting... (${this.reconnectAttempts}/${this.MAX_RECONNECT_ATTEMPTS})`),this.reconnectTimer=setTimeout(()=>{this.connect()},this.RECONNECT_DELAY)):console.error("[SSE Manager] Max reconnect attempts reached")}subscribe(e,t){return this.messageListeners.has(e)||this.messageListeners.set(e,new Set),this.messageListeners.get(e).add(t),this.eventSource||this.connect(),()=>{this.unsubscribe(e,t)}}unsubscribe(e,t){let s=this.messageListeners.get(e);s&&(s.delete(t),0===s.size&&this.messageListeners.delete(e)),0===this.messageListeners.size&&this.disconnect()}subscribeConnection(e){return this.connectionListeners.add(e),e(this.isConnected),()=>{this.connectionListeners.delete(e)}}notifyMessageListeners(e,t){let s=this.messageListeners.get(e);s&&s.forEach(e=>e(t));let r=this.messageListeners.get("*");r&&r.forEach(e=>e(t))}notifyConnectionListeners(e){this.connectionListeners.forEach(t=>t(e))}disconnect(){console.log("[SSE Manager] Disconnecting..."),this.cleanup()}cleanup(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isConnected=!1}clearProcessedMessages(){if(this.processedMessages.size>1e3){let e=Array.from(this.processedMessages).slice(-1e3);this.processedMessages=new Set(e)}}getStatus(){return{connected:this.isConnected,reconnectAttempts:this.reconnectAttempts,listenerCount:this.messageListeners.size,processedMessageCount:this.processedMessages.size,readyState:this.eventSource?.readyState}}}function eF(e){let t,s,r,a,i,o,c,d,u=(0,l.c)(14),{roomName:m,onMessage:p,enabled:g}=e,x=void 0===g||g;u[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],u[0]=t):t=u[0];let[h,f]=(0,n.useState)(t),[y,_]=(0,n.useState)(!1);u[1]===Symbol.for("react.memo_cache_sentinel")?(s=new Set,u[1]=s):s=u[1];let b=(0,n.useRef)(s),v=(0,n.useRef)(void 0);u[2]!==x?(r=()=>{if(!x)return;v.current=eT.getInstance();let e=v.current.subscribeConnection(e=>{_(e)});return()=>{e()}},a=[x],u[2]=x,u[3]=r,u[4]=a):(r=u[3],a=u[4]),(0,n.useEffect)(r,a),u[5]!==x||u[6]!==p||u[7]!==m?(i=()=>{if(!x||!m)return;let e=v.current?.subscribe(m,e=>{!b.current.has(e.message_id)&&(b.current.add(e.message_id),f(t=>[...t,e]),p&&p(e))});return()=>{e&&e()}},o=[x,m,p],u[5]=x,u[6]=p,u[7]=m,u[8]=i,u[9]=o):(i=u[8],o=u[9]),(0,n.useEffect)(i,o),u[10]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{f([]),b.current.clear()},u[10]=c):c=u[10];let j=c;return u[11]!==y||u[12]!==h?(d={messages:h,isConnected:y,clearMessages:j},u[11]=y,u[12]=h,u[13]=d):d=u[13],d}e.s(["default",0,eT],45747),e.s(["useSSEManager",()=>eF],83850)},34920,70480,e=>{"use strict";var t=e.i(43476),s=e.i(932),r=e.i(71645),a=e.i(76639),l=e.i(59684),n=e.i(19455),i=e.i(55764),o=e.i(87486),c=e.i(14764),d=e.i(84614);e.i(64659),e.i(55900);var u=e.i(37727),m=e.i(95468),p=e.i(14683),g=e.i(63209),x=e.i(86311),h=e.i(83086),f=e.i(7233),y=e.i(88699),_=e.i(43531),b=e.i(25652),v=e.i(45423),j=e.i(40392),N=e.i(29228),w=e.i(55706),k=e.i(85183),S=e.i(93230),C=e.i(72526),q=e.i(34239),$=e.i(31195),D=e.i(75157),M=e.i(94913),A=e.i(89271),E=e.i(96357),I=e.i(83850),T=e.i(45747);e.i(28856);var F=e.i(64566);e.s(["useDealStore",()=>F.default],70480);var F=F,R=e.i(61238),O=e.i(8069);let P=(0,e.i(75254).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var U=e.i(31278);function B({roomName:e,platform:s,onSend:a,className:l}){let[i,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await O.quickReplyAPI.getTemplates();o(e)}catch(e){console.error("Failed to fetch quick reply templates:",e)}finally{d(!1)}})()},[]);let p=async t=>{if(e){m(t.id);try{(await O.quickReplyAPI.send(e,t.template_text)).success&&a?.(t.template_text)}catch(e){console.error("Failed to send quick reply:",e)}finally{m(null)}}};return c?(0,t.jsxs)("div",{className:(0,D.cn)("flex items-center gap-2 text-muted-foreground text-sm",l),children:[(0,t.jsx)(U.Loader2,{className:"w-3 h-3 animate-spin"}),(0,t.jsx)("span",{children:"빠른 응답 로딩..."})]}):0===i.length?null:(0,t.jsxs)("div",{className:(0,D.cn)("flex items-center gap-1.5 flex-wrap",l),children:[(0,t.jsx)(P,{className:"w-3.5 h-3.5 text-yellow-500 mr-1"}),i.map(e=>(0,t.jsx)(n.Button,{variant:"outline",size:"sm",className:"h-7 px-2.5 text-xs font-normal hover:bg-primary hover:text-primary-foreground transition-colors",onClick:()=>p(e),disabled:null!==u,children:u===e.id?(0,t.jsx)(U.Loader2,{className:"w-3 h-3 animate-spin"}):e.template_text},e.id))]})}function z(e){let r,l,n,i,o,c=(0,s.c)(12),{session:d,open:u,onClose:m}=e;if(!d)return null;let p=d.vessel_name||"Vessel TBD";return c[0]!==p?(r=(0,t.jsxs)(a.DialogTitle,{className:"sr-only",children:["Deal Details - ",p]}),c[0]=p,c[1]=r):r=c[1],c[2]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)(L,{}),c[2]=l):l=c[2],c[3]!==r?(n=(0,t.jsxs)(a.DialogContent,{className:"max-w-[95vw] w-[95vw] max-h-[90vh] p-0",children:[r,l]}),c[3]=r,c[4]=n):n=c[4],c[5]!==m||c[6]!==u||c[7]!==n?(i=(0,t.jsx)(a.Dialog,{open:u,onOpenChange:m,children:n}),c[5]=m,c[6]=u,c[7]=n,c[8]=i):i=c[8],c[9]!==d||c[10]!==i?(o=(0,t.jsx)(E.DealModalProvider,{session:d,children:i}),c[9]=d,c[10]=i,c[11]=o):o=c[11],o}function L(){let{session:e,showAIPanel:s,setShowAIPanel:a,setRoomPlatforms:l}=(0,E.useDealModal)(),n=(0,r.useRef)(null);return((0,r.useEffect)(()=>{(async()=>{try{let e=await fetch(`${(0,R.getApiUrl)()}/chats/rooms`);if(e.ok){let t=await e.json(),s=new Map;(t.rooms||[]).forEach(e=>{s.set(e.room_name,e.platform)}),l(s)}}catch(e){console.error("Failed to fetch room platforms:",e)}})()},[l]),e)?(0,t.jsxs)("div",{className:"flex flex-col h-[90vh]",children:[(0,t.jsx)(W,{session:e,showAIPanel:s,onToggleAI:()=>a(!0)}),(0,t.jsxs)("div",{ref:n,className:"flex flex-1 relative overflow-hidden",children:[(0,t.jsx)("div",{className:"border-r h-full",style:{width:"24%"},children:(0,t.jsx)(H,{})}),s&&(0,t.jsx)("div",{className:"border-r bg-gray-50 h-full",style:{width:"52%"},children:(0,t.jsx)(X,{})}),(0,t.jsx)("div",{className:"h-full",style:{width:s?"24%":"76%"},children:(0,t.jsx)(Q,{})})]})]}):null}let W=(0,r.memo)(e=>{let r,a,l,i,o,c,d,u,m,p,g,x,f,y=(0,s.c)(30),{session:_,showAIPanel:b,onToggleAI:v}=e;y[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("span",{className:"text-gray-500",children:"Vessel:"}),y[0]=r):r=y[0];let j=_.vessel_name||"-";y[1]!==j?(a=(0,t.jsxs)("div",{className:"whitespace-nowrap",children:[r," ",j]}),y[1]=j,y[2]=a):a=y[2],y[3]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)("span",{className:"text-gray-500",children:"ETA:"}),y[3]=l):l=y[3];let N=_.delivery_date||"-";y[4]!==N?(i=(0,t.jsxs)("div",{className:"whitespace-nowrap",children:[l," ",N]}),y[4]=N,y[5]=i):i=y[5],y[6]===Symbol.for("react.memo_cache_sentinel")?(o=(0,t.jsx)("span",{className:"text-gray-500",children:"Port:"}),y[6]=o):o=y[6];let w=_.port||"-";y[7]!==w?(c=(0,t.jsxs)("div",{className:"whitespace-nowrap",children:[o," ",w]}),y[7]=w,y[8]=c):c=y[8],y[9]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)("span",{className:"text-gray-500",children:"Fuel:"}),y[9]=d):d=y[9];let k=_.fuel_type||"-",S=_.quantity||"";return y[10]!==_.fuel_type2||y[11]!==_.quantity2?(u=_.fuel_type2&&(0,t.jsxs)("span",{className:"text-yellow-400 ml-2",children:["+ ",_.fuel_type2," ",_.quantity2||""]}),y[10]=_.fuel_type2,y[11]=_.quantity2,y[12]=u):u=y[12],y[13]!==k||y[14]!==S||y[15]!==u?(m=(0,t.jsxs)("div",{className:"whitespace-nowrap",children:[d," ",k," ",S,u]}),y[13]=k,y[14]=S,y[15]=u,y[16]=m):m=y[16],y[17]===Symbol.for("react.memo_cache_sentinel")?(p=(0,t.jsx)("span",{className:"text-gray-500",children:"Customer:"}),y[17]=p):p=y[17],y[18]!==_.customer_room_name?(g=(0,t.jsxs)("div",{className:"whitespace-nowrap",children:[p," ",_.customer_room_name]}),y[18]=_.customer_room_name,y[19]=g):g=y[19],y[20]!==v||y[21]!==b?(x=!b&&(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:v,className:"ml-auto text-green-400 hover:text-green-300 hover:bg-gray-800",children:[(0,t.jsx)(h.Sparkles,{className:"w-4 h-4 mr-1"}),"AI Assistant"]}),y[20]=v,y[21]=b,y[22]=x):x=y[22],y[23]!==m||y[24]!==g||y[25]!==x||y[26]!==a||y[27]!==i||y[28]!==c?(f=(0,t.jsx)("div",{className:"bg-gray-900 text-green-400 font-mono p-3 border-b",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-xs",children:[a,i,c,m,g,x]})}),y[23]=m,y[24]=g,y[25]=x,y[26]=a,y[27]=i,y[28]=c,y[29]=f):f=y[29],f});W.displayName="DealHeader";let H=(0,r.memo)(()=>{let{session:e,buyerMessages:s,addBuyerMessage:a,setBuyerMessages:d,getRoomPlatform:u,roomPlatforms:m}=(0,E.useDealModal)(),[p,g]=(0,r.useState)(""),h=(0,r.useRef)(null),f=(0,r.useRef)(!1),y=(0,r.useRef)(0);(0,r.useEffect)(()=>{if(!e?.customer_room_name||0===m.size||f.current)return;f.current=!0;let t=u(e.customer_room_name);(async()=>{try{let s=await fetch(`${(0,R.getApiUrl)()}/chats/${encodeURIComponent(e.customer_room_name)}/messages?platform=${t}`);if(s.ok){let r=await s.json(),a=Array.isArray(r)?r:r.data||[],l=["Harold","씨너지파트너","Seanergy","seanergyAI","SeanergyAI","김성원","김민석","권우정","Yong","Kenn","Me","나","씨너지파트너 주식회사","씨너지파트너AI","Seanergy AI","Harold AI","Yong Oh","Kenn Kwon","Kenn Kwon (SEANERGY PARTNER)","seanergy ai"];d(a.map(e=>({message_id:e.id||e.message_id,room_name:e.room_name,sender:e.sender,message:e.message,timestamp:e.created_at,package_name:e.platform||"com.kakao.talk",direction:e.direction||(l.some(t=>e.sender?.includes(t))?"outgoing":"incoming"),created_at:e.created_at,reply_to_message:e.reply_to_message,reply_to_author:e.reply_to_author})));try{await fetch(`${(0,R.getApiUrl)()}/chats/${encodeURIComponent(e.customer_room_name)}/mark-read?platform=${{"com.kakao.talk":"kakao","com.kakao.yellowid":"kakao_biz","com.whatsapp":"whatsapp","com.wechat":"wechat"}[t]||"kakao"}`,{method:"POST"})}catch(e){console.error("Failed to mark buyer messages as read:",e)}}}catch(e){console.error("Failed to fetch buyer messages:",e)}})()},[e?.customer_room_name,m.size]),(0,I.useSSEManager)({roomName:e?.customer_room_name,onMessage:a,enabled:!0}),(0,r.useEffect)(()=>{if(s.length>0){let e=0===y.current&&s.length>0,t=s.length>y.current;if(e||t){let e=()=>{let e=h.current?.querySelector("[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)};e(),setTimeout(e,50),setTimeout(e,150)}y.current=s.length}},[s]);let _=async()=>{if(!p.trim()||!e)return;let t=u(e.customer_room_name),s={"com.kakao.talk":"kakao","com.kakao.yellowid":"kakao_biz","com.whatsapp":"whatsapp","com.wechat":"wechat"}[t]||"kakao";a({message_id:Date.now(),room_name:e.customer_room_name,sender:"Harold",message:p,timestamp:new Date().toISOString(),package_name:t,direction:"outgoing",created_at:new Date().toISOString()}),g("");try{await fetch(`${(0,R.getApiUrl)()}/messages/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_name:e.customer_room_name,message:p,platform:s})})}catch(e){console.error("Failed to send message:",e)}};return(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"p-3 border-b bg-white",children:(0,t.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(x.MessageSquare,{className:"w-4 h-4"}),"Buyer Chat",(0,t.jsx)(o.Badge,{variant:"secondary",className:"ml-auto text-xs",children:e?.customer_room_name&&e.customer_room_name.length>15?`${e.customer_room_name.slice(0,15)}...`:e?.customer_room_name})]})}),(0,t.jsx)(K,{session:e}),(0,t.jsx)(l.ScrollArea,{className:"flex-1 p-4",ref:h,children:(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,t.jsx)(G,{message:e},e.message_id))})}),(0,t.jsxs)("div",{className:"p-3 border-t bg-white space-y-2",children:[e?.customer_room_name&&(0,t.jsx)(B,{roomName:e.customer_room_name,onSend:t=>{a({message_id:Date.now(),room_name:e.customer_room_name,sender:"나",message:t,package_name:"com.kakao.talk",direction:"outgoing",timestamp:new Date().toISOString(),created_at:new Date().toISOString()})},className:"pb-1"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.Input,{value:p,onChange:e=>g(e.target.value),onKeyPress:e=>"Enter"===e.key&&_(),placeholder:"Type a message...",className:"flex-1"}),(0,t.jsx)(n.Button,{onClick:_,size:"icon",children:(0,t.jsx)(c.Send,{className:"w-4 h-4"})})]})]})]})});H.displayName="BuyerChatColumn";let K=(0,r.memo)(({session:e})=>{let{addBuyerMessage:s,getRoomPlatform:a,updateSession:l}=(0,E.useDealModal)(),[n,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)({}),[d,g]=(0,r.useState)(!1),x=async()=>{if(e){g(!0);try{(await fetch(`${(0,R.getApiUrl)()}/sessions/${e.session_id}/fields`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({vessel_name:o.vessel||null,imo:o.imo||null,port:o.port||null,delivery_date:o.eta||null,fuel_type:o.fuel1||null,quantity:o.qty1?parseFloat(o.qty1):null,fuel_type2:o.fuel2||null,quantity2:o.qty2?parseFloat(o.qty2):null})})).ok?(l&&l({vessel_name:o.vessel||void 0,imo:o.imo||void 0,port:o.port||void 0,delivery_date:o.eta||void 0,fuel_type:o.fuel1||void 0,quantity:o.qty1||void 0,fuel_type2:o.fuel2||void 0,quantity2:o.qty2||void 0}),i(!1)):console.error("Failed to update session fields")}catch(e){console.error("Failed to update session:",e)}finally{g(!1)}}},h=(t,s="ko")=>{let r={vessel:{ko:"배 이름이 어떻게 되나요?",en:"What is the vessel name?"},port:{ko:"포트가 어떻게 되나요?",en:"What is the port?"},eta:{ko:"ETA가 어떻게 되나요?",en:"What is the ETA?"},fuel1:{ko:"유종이 어떻게 되나요?",en:"What is the fuel type?"}};return"fuel2"===t?"en"===s?e?.fuel_type2?`What is the ${e.fuel_type2} type?`:"What is the second fuel type?":e?.fuel_type2?`${e.fuel_type2} 유종이 어떻게 되나요?`:"유종이 어떻게 되나요?":"qty1"===t?"en"===s?e?.fuel_type?`What is the quantity for ${e.fuel_type}?`:"What is the quantity?":e?.fuel_type?`${e.fuel_type} 수량은 어떻게 되나요?`:"수량은 어떻게 되나요?":"qty2"===t?"en"===s?e?.fuel_type2?`What is the quantity for ${e.fuel_type2}?`:"What is the second fuel quantity?":e?.fuel_type2?`${e.fuel_type2} 수량은 어떻게 되나요?`:"수량은 어떻게 되나요?":r[t]?.[s]||r[t]?.ko||""},f=async t=>{if(!e||n)return;let r=h(t);if(!r)return;let l=a(e.customer_room_name),i={"com.kakao.talk":"kakao","com.kakao.yellowid":"kakao_biz","com.whatsapp":"whatsapp","com.wechat":"wechat"}[l]||"kakao";s({message_id:Date.now(),room_name:e.customer_room_name,sender:"Harold",message:r,timestamp:new Date().toISOString(),package_name:l,direction:"outgoing",created_at:new Date().toISOString()});try{await fetch(`${(0,R.getApiUrl)()}/messages/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_name:e.customer_room_name,message:r,platform:i})})}catch(e){console.error("Failed to send question:",e)}},b=[[{key:"vessel",label:"Vessel",value:e?.vessel_name,filled:!!e?.vessel_name,required:!0},{key:"imo",label:"IMO",value:e?.imo,filled:!!e?.imo,required:!1}],[{key:"port",label:"Port",value:e?.port,filled:!!e?.port,required:!0},{key:"eta",label:"ETA",value:e?.delivery_date,filled:!!e?.delivery_date,required:!0}],[{key:"fuel1",label:"Fuel1",value:e?.fuel_type,filled:!!e?.fuel_type,required:!0},{key:"qty1",label:"QTY1",value:e?.quantity,filled:!!e?.quantity,required:!0}],...e?.fuel_type2||n?[[{key:"fuel2",label:"Fuel2",value:e?.fuel_type2,filled:!!e?.fuel_type2,required:!0},{key:"qty2",label:"QTY2",value:e?.quantity2,filled:!!e?.quantity2,required:!0}]]:[]],v=b.flat().filter(e=>e.required),j=v.filter(e=>e.filled).length,N=v.length,w=Math.round(j/N*100);return(0,t.jsxs)("div",{className:"p-2 border-b bg-gradient-to-r from-purple-50 to-blue-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-purple-700",children:"Required FullContext"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:(0,D.cn)("text-[10px] px-2 py-0.5 rounded-full",100===w?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:[j,"/",N," (",w,"%)"]}),n?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:x,disabled:d,className:"p-1 rounded hover:bg-green-100 text-green-600 disabled:opacity-50",title:"Save",children:(0,t.jsx)(_.Check,{className:"w-3.5 h-3.5"})}),(0,t.jsx)("button",{onClick:()=>i(!1),className:"p-1 rounded hover:bg-red-100 text-red-600",title:"Cancel",children:(0,t.jsx)(u.X,{className:"w-3.5 h-3.5"})})]}):(0,t.jsx)("button",{onClick:()=>{c({vessel:e?.vessel_name||"",imo:e?.imo||"",port:e?.port||"",eta:e?.delivery_date||"",fuel1:e?.fuel_type||"",qty1:e?.quantity?.toString()||"",fuel2:e?.fuel_type2||"",qty2:e?.quantity2?.toString()||""}),i(!0)},className:"p-1 rounded hover:bg-purple-100 text-purple-600",title:"Edit fields",children:(0,t.jsx)(y.Pencil,{className:"w-3.5 h-3.5"})})]})]}),(0,t.jsx)("div",{className:"space-y-1",children:b.map((e,s)=>(0,t.jsx)("div",{className:1===e.length?"":"grid grid-cols-2 gap-1",children:e.map(e=>(0,t.jsxs)("div",{onClick:()=>!n&&!e.filled&&f(e.key),title:n||e.filled?"":`Click to ask: "${h(e.key)}"`,className:(0,D.cn)("flex items-center gap-1 px-2 py-1 rounded text-[10px]",n?"bg-white border border-purple-200":e.filled?"bg-green-100/50 border border-green-200":"bg-white border border-dashed border-gray-300 cursor-pointer hover:bg-red-50 hover:border-red-300"),children:[!n&&(e.filled?(0,t.jsx)(m.CheckCircle2,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):(0,t.jsx)(p.Circle,{className:"w-3 h-3 text-red-400 flex-shrink-0"})),(0,t.jsxs)("span",{className:"font-medium text-gray-600 flex-shrink-0",children:[e.label,":"]}),n?(0,t.jsx)("input",{type:e.key.includes("qty")?"number":"text",value:o[e.key]||"",onChange:t=>c(s=>({...s,[e.key]:t.target.value})),className:"flex-1 min-w-0 bg-transparent border-none outline-none text-[10px] text-purple-700 font-medium",placeholder:e.label}):(0,t.jsx)("span",{className:(0,D.cn)("truncate",e.filled?"text-green-700 font-medium":"text-gray-400 italic"),children:e.value||"—"})]},e.key))},s))})]})});K.displayName="BuyerRequiredFullContext";let V=(0,r.memo)(({customerRoom:e,vesselName:s,currentSessionId:a})=>{let[l,n]=(0,r.useState)([]),[i,o]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{if(e&&s){o(!0);try{let t=await fetch(`${(0,R.getApiUrl)()}/customers/${encodeURIComponent(e)}/vessels/${encodeURIComponent(s)}/history`);if(t.ok){let e=await t.json();n(e.history||[])}}catch(e){console.error("Failed to fetch vessel history:",e),n([])}finally{o(!1)}}})()},[e,s]),i)?(0,t.jsx)("div",{className:"px-3 py-4 text-center text-gray-400 text-xs",children:"Loading..."}):0===l.length?(0,t.jsx)("div",{className:"px-3 py-4 text-center text-gray-400 text-xs",children:"No inquiry history"}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-[10px]",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b",children:[(0,t.jsx)("th",{className:"px-2 py-1.5 text-left font-medium text-gray-600 min-w-[70px]",children:"Date"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-left font-medium text-gray-600 min-w-[60px]",children:"Port"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-left font-medium text-gray-600 min-w-[70px]",children:"ETA"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-left font-medium text-gray-600 min-w-[90px]",children:"Fuel1"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-left font-medium text-gray-600 min-w-[90px]",children:"Fuel2"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-green-700 bg-green-50 min-w-[70px]",children:"Offer"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-blue-700 bg-blue-50 min-w-[70px]",children:"Customer"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-purple-700 bg-purple-50 min-w-[70px]",children:"Deal Done"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-gray-600 min-w-[70px]",children:"Margin"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-gray-600 min-w-[55px]",children:"Status"})]})}),(0,t.jsx)("tbody",{children:l.map(e=>{let s=e.session_id===a,r=e.offers[0],l=e.purchase_prices[0],n=e.margin_per_ton[0];return(0,t.jsxs)("tr",{className:(0,D.cn)("border-b hover:bg-gray-50",s&&"bg-orange-50"),children:[(0,t.jsxs)("td",{className:"px-2 py-1.5 text-gray-700",children:[e.inquiry_date?new Date(e.inquiry_date).toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit"}):"—",s&&(0,t.jsx)("span",{className:"ml-1 text-orange-500",children:"●"})]}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-gray-700",children:e.port||"—"}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-gray-700",children:e.eta||"—"}),(0,t.jsxs)("td",{className:"px-2 py-1.5",children:[(0,t.jsx)("div",{className:"text-gray-700",children:e.fuel1||"—"}),e.fuel1_qty&&(0,t.jsx)("div",{className:"text-[9px] text-gray-400",children:e.fuel1_qty})]}),(0,t.jsx)("td",{className:"px-2 py-1.5",children:e.fuel2?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-gray-700",children:e.fuel2}),e.fuel2_qty&&(0,t.jsx)("div",{className:"text-[9px] text-gray-400",children:e.fuel2_qty})]}):(0,t.jsx)("span",{className:"text-gray-300",children:"—"})}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-center bg-green-50/50",children:r?(0,t.jsx)("span",{className:"font-medium text-green-700",children:r.price}):(0,t.jsx)("span",{className:"text-gray-300",children:"—"})}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-center bg-blue-50/50",children:l?(0,t.jsx)("span",{className:"font-medium text-blue-700",children:l.price}):(0,t.jsx)("span",{className:"text-gray-300",children:"—"})}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-center bg-purple-50/50",children:e.deal_done_price?(0,t.jsx)("span",{className:"font-bold text-purple-700",children:e.deal_done_price}):(0,t.jsx)("span",{className:"text-gray-300",children:"—"})}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-center",children:n?(0,t.jsxs)("div",{className:"text-gray-700 text-[9px]",children:[n.fuel1_margin&&(0,t.jsx)("div",{children:n.fuel1_margin}),n.fuel2_margin&&(0,t.jsx)("div",{children:n.fuel2_margin})]}):(0,t.jsx)("span",{className:"text-gray-300",children:"—"})}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-center",children:(0,t.jsx)("span",{className:(0,D.cn)("px-1.5 py-0.5 rounded text-[9px]","closed_success"===e.status?"bg-green-100 text-green-700":"closed_lost"===e.status||"closed_failed"===e.status?"bg-red-100 text-red-700":"active"===e.status?"bg-blue-100 text-blue-700":(e.status,"bg-gray-100 text-gray-600")),children:"closed_success"===e.status?"Done":"closed_lost"===e.status?"Lost":"closed_failed"===e.status?"Failed":"active"===e.status?"Active":"no_offer"===e.status?"N/O":e.status||"—"})})]},e.session_id)})})]})})});V.displayName="BuyerVesselHistory";let J=(0,r.memo)(()=>{let{session:e,getRoomPlatform:s,addSellerMessage:a,addSellerTab:l}=(0,E.useDealModal)(),[n,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)({}),[d,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[x,h]=(0,r.useState)(""),[b,v]=(0,r.useState)([]),j=(0,F.default)(e=>e.setSellerContexts),[N,w]=(0,r.useState)(null),[k,S]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch(`${(0,R.getApiUrl)()}/api/traders/all`);if(e.ok){let t=await e.json();v(t)}}catch(e){console.error("Failed to fetch all traders:",e)}})()},[]);let C=e?.session_id||"",q=(0,F.default)(e=>e.sellerContextsBySession),$=C?q.get(C):void 0,M=$?Object.keys($):e?.seller_contexts?Object.keys(e.seller_contexts):e?.requested_traders||[],A=e?.fuel_type2?2:1,I=[{key:"deal_total",label:"TOTAL",isCalculated:!0},{key:"fuel1_price",label:`${e?.fuel_type||"Fuel1"} Price`},...A>=2?[{key:"fuel2_price",label:`${e?.fuel_type2||"Fuel2"} Price`}]:[],{key:"barge_fee",label:"Barge Fee"},{key:"earliest",label:"Earliest"},{key:"supplier",label:"Supplier"},{key:"term",label:"Term"},{key:"fuel1_margin",label:`${e?.fuel_type||"Fuel1"} Margin`,isMargin:!0},...A>=2?[{key:"fuel2_margin",label:`${e?.fuel_type2||"Fuel2"} Margin`,isMargin:!0}]:[],{key:"total",label:"Profit",isCalculated:!0}],T=t=>$?.[t]||e?.seller_contexts?.[t],O=async()=>{if(e){m(!0);try{for(let t of M){let s=o[t];if(s&&(await fetch(`${(0,R.getApiUrl)()}/sessions/${e.session_id}/seller-context/${encodeURIComponent(t)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quote:{fuel1_price:s.fuel1_price||null,fuel2_price:s.fuel2_price||null,barge_fee:s.barge_fee||null,term:s.term||null,supplier:s.supplier||null,fuel1_margin:s.fuel1_margin||null,fuel2_margin:s.fuel2_margin||null},earliest:s.earliest||null})})).ok){let r=$||{},a={...r,[t]:{...r[t],quote:{...r[t]?.quote,fuel1_price:s.fuel1_price||void 0,fuel2_price:s.fuel2_price||void 0,barge_fee:s.barge_fee||void 0,term:s.term||void 0,supplier:s.supplier||void 0,fuel1_margin:s.fuel1_margin||void 0,fuel2_margin:s.fuel2_margin||void 0},earliest:s.earliest||void 0}};j(e.session_id,a)}}i(!1)}catch(e){console.error("Failed to update seller contexts:",e)}finally{m(!1)}}},P=async()=>{if(e&&x.trim())try{if((await fetch(`${(0,R.getApiUrl)()}/sessions/${e.session_id}/seller-context/${encodeURIComponent(x.trim())}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"waiting_quote"})})).ok){let t={...$||{},[x.trim()]:{status:"waiting_quote",quote:{}}};j(e.session_id,t),l(x.trim()),h(""),g(!1)}}catch(e){console.error("Failed to add seller:",e)}},U=async(t,s,r)=>{if(e){try{let a=T(t),l=a?.quote||{};if((await fetch(`${(0,R.getApiUrl)()}/sessions/${e.session_id}/seller-context/${encodeURIComponent(t)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quote:{...l,[s]:r||null}})})).ok){let a=$||{},l={...a,[t]:{...a[t],status:a[t]?.status||"waiting_quote",quote:{...a[t]?.quote,[s]:r||void 0}}};j(e.session_id,l)}}catch(e){console.error("Failed to save margin:",e)}w(null),S("")}},B=(t,s="ko")=>{if("fuel1_price"===t)return"en"===s?e?.fuel_type?`What is the price for ${e.fuel_type}?`:"What is the price?":e?.fuel_type?`${e.fuel_type} 가격이 어떻게 되나요?`:"가격이 어떻게 되나요?";if("fuel2_price"===t)return"en"===s?e?.fuel_type2?`What is the price for ${e.fuel_type2}?`:"What is the price for the second fuel?":e?.fuel_type2?`${e.fuel_type2} 가격이 어떻게 되나요?`:"가격이 어떻게 되나요?";let r={barge_fee:{ko:"바지피가 어떻게 되나요?",en:"What is the barge fee?"},earliest:{ko:"얼리 언제인가요?",en:"When is the earliest?"},supplier:{ko:"서플 어디인가요?",en:"Who is the supplier?"},term:{ko:"페이먼트 텀이 어떻게 되나요?",en:"What are the payment terms?"}};return r[t]?.[s]||r[t]?.ko||""},z=async(t,r)=>{if(n)return;let l=B(r);if(!l)return;console.log("[SellerMatrix] Cell clicked:",{trader:t,fieldKey:r,question:l,sessionId:e?.session_id});let i=s(t),o={"com.kakao.talk":"kakao","com.kakao.yellowid":"kakao_biz","com.whatsapp":"whatsapp","com.wechat":"wechat"}[i]||"kakao",c={message_id:Date.now(),room_name:t,sender:"Harold",message:l,timestamp:new Date().toISOString(),package_name:i,direction:"outgoing",created_at:new Date().toISOString()};a(t,c);try{await fetch(`${(0,R.getApiUrl)()}/messages/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_name:t,message:l,platform:o,session_id:e?.session_id})})}catch(e){console.error("Failed to send question:",e)}};return(0,t.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-3 py-2 bg-gradient-to-r from-indigo-50 to-purple-50 border-b flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-indigo-700",children:"Seller Quote Matrix"}),(0,t.jsx)("div",{className:"flex items-center gap-1",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:O,disabled:d,className:"p-1 rounded hover:bg-green-100 text-green-600 disabled:opacity-50",title:"Save",children:(0,t.jsx)(_.Check,{className:"w-3.5 h-3.5"})}),(0,t.jsx)("button",{onClick:()=>i(!1),className:"p-1 rounded hover:bg-red-100 text-red-600",title:"Cancel",children:(0,t.jsx)(u.X,{className:"w-3.5 h-3.5"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>g(!0),className:"p-1 rounded hover:bg-indigo-100 text-indigo-600",title:"Add Seller",children:(0,t.jsx)(f.Plus,{className:"w-3.5 h-3.5"})}),(0,t.jsx)("button",{onClick:()=>{let e={};M.forEach(t=>{let s=T(t);e[t]={fuel1_price:s?.quote?.fuel1_price||"",fuel2_price:s?.quote?.fuel2_price||"",barge_fee:s?.quote?.barge_fee||"",earliest:s?.earliest||"",supplier:s?.quote?.supplier||"",term:s?.quote?.term||"",fuel1_margin:s?.quote?.fuel1_margin||"",fuel2_margin:s?.quote?.fuel2_margin||""}}),c(e),i(!0)},className:"p-1 rounded hover:bg-indigo-100 text-indigo-600",title:"Edit quotes",children:(0,t.jsx)(y.Pencil,{className:"w-3.5 h-3.5"})})]})})]}),p&&(0,t.jsxs)("div",{className:"px-3 py-2 bg-indigo-50 border-b flex items-center gap-2",children:[(0,t.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"flex-1 px-2 py-1 text-xs border rounded focus:outline-none focus:ring-1 focus:ring-indigo-500 bg-white",children:[(0,t.jsx)("option",{value:"",children:"Select seller..."}),b.filter(e=>!M.includes(e.room_name)).map(e=>(0,t.jsxs)("option",{value:e.room_name,children:[e.name," (",e.room_name,")"]},e.id))]}),(0,t.jsx)("button",{onClick:P,disabled:!x,className:"px-2 py-1 text-xs bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add"}),(0,t.jsx)("button",{onClick:()=>{g(!1),h("")},className:"p-1 text-gray-500 hover:text-gray-700",children:(0,t.jsx)(u.X,{className:"w-3.5 h-3.5"})})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-[10px]",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b",children:[(0,t.jsx)("th",{className:"px-2 py-1.5 text-left font-medium text-gray-600 sticky left-0 bg-gray-50 min-w-[100px]",children:"Seller"}),I.map(e=>{let s=e.isMargin,r="deal_total"===e.key,a="total"===e.key;return(0,t.jsx)("th",{className:(0,D.cn)("px-2 py-1.5 text-center font-medium min-w-[80px]",s?"text-purple-700 bg-purple-50":r?"text-blue-700 bg-blue-50":a?"text-green-700 bg-green-50":"text-gray-700"),children:e.label},e.key)})]})}),(0,t.jsx)("tbody",{children:0===M.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:I.length+1,className:"px-2 py-4 text-center text-gray-500",children:"No sellers requested yet"})}):M.map((s,r)=>(0,t.jsxs)("tr",{className:r%2==0?"bg-white":"bg-gray-50/50",children:[(0,t.jsx)("td",{className:"px-2 py-1.5 font-medium text-gray-700 sticky left-0 bg-inherit border-r min-w-[100px]",title:s,children:s.length<=10?s:s.slice(0,8)+".."}),I.map(r=>{let a=((t,s)=>{let r=T(t);if("fuel1_margin"===s)return r?.quote?.fuel1_margin||null;if("fuel2_margin"===s)return r?.quote?.fuel2_margin||null;if(!r)return null;if("earliest"===s)return r.earliest||null;if("term"===s)return r.quote?.term||null;if("supplier"===s)return r.quote?.supplier||null;let a=e=>{if(!e)return 0;let t=e.split("-");if(t.length>=2){let e=parseFloat(t[0].replace(/[^0-9.]/g,"")||"0"),s=parseFloat(t[1].replace(/[^0-9.]/g,"")||"0");return isNaN(e)||isNaN(s)?0:(e+s)/2}let s=parseFloat(e.replace(/[^0-9.]/g,"")||"0");return isNaN(s)?0:s};if("deal_total"===s){let t=parseFloat(r.quote?.fuel1_price?.replace(/[,$]/g,"")||"0"),s=parseFloat(r.quote?.fuel2_price?.replace(/[,$]/g,"")||"0"),l=parseFloat(r.quote?.barge_fee?.replace(/[,$]/g,"")||"0");if(0===t&&0===s)return null;let n=t*a(e?.quantity)+s*a(e?.quantity2)+l;return 0===n?null:"$"+n.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}if("total"===s){let t=parseFloat(r.quote?.fuel1_margin?.replace(/[,$]/g,"")||"0"),s=parseFloat(r.quote?.fuel2_margin?.replace(/[,$]/g,"")||"0");if(0===t&&0===s)return null;let l=t*a(e?.quantity)+s*a(e?.quantity2);return 0===l?null:"$"+l.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}return r.quote?.[s]||null})(s,r.key),l=!!a,i=r.isCalculated,d=r.isMargin;return n&&d?(0,t.jsx)("td",{className:"px-1 py-0.5 bg-purple-50",children:(0,t.jsx)("input",{type:"text",value:o[s]?.[r.key]||"",onChange:e=>c(t=>({...t,[s]:{...t[s],[r.key]:e.target.value}})),className:"w-full px-1 py-0.5 text-[10px] text-center border border-purple-200 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 bg-white",placeholder:"$0"})},`${s}-${r.key}`):d?N?.seller===s&&N?.field===r.key?(0,t.jsx)("td",{className:"px-2 py-1.5 text-center bg-purple-50",children:(0,t.jsx)("input",{type:"text",autoFocus:!0,value:k,onChange:e=>S(e.target.value),onBlur:()=>U(s,r.key,k),onKeyDown:e=>{"Enter"===e.key?U(s,r.key,k):"Escape"===e.key&&(w(null),S(""))},className:"w-16 px-1 py-0.5 text-[11px] text-center border border-purple-300 rounded bg-white text-purple-700 font-medium focus:outline-none focus:ring-1 focus:ring-purple-400",placeholder:"$0"})},`${s}-${r.key}`):(0,t.jsx)("td",{onClick:()=>{w({seller:s,field:r.key}),S(a||"")},className:(0,D.cn)("px-2 py-1.5 text-center bg-purple-50 cursor-pointer hover:bg-purple-100 transition-colors",l?"text-purple-700 font-medium":"text-gray-400"),title:"Click to edit margin",children:l?a:"—"},`${s}-${r.key}`):n&&!i?(0,t.jsx)("td",{className:"px-1 py-0.5",children:(0,t.jsx)("input",{type:"text",value:o[s]?.[r.key]||"",onChange:e=>c(t=>({...t,[s]:{...t[s],[r.key]:e.target.value}})),className:"w-full px-1 py-0.5 text-[10px] text-center border rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"—"})},`${s}-${r.key}`):(0,t.jsx)("td",{onClick:()=>!l&&!i&&z(s,r.key),title:l||i?a||"":`Click to ask: "${B(r.key)}"`,className:(0,D.cn)("px-2 py-1.5 text-center",l?"deal_total"===r.key?"text-blue-700 font-bold bg-blue-50":"total"===r.key?"text-green-700 font-bold bg-green-50":"text-green-700 font-medium":i?"text-gray-300":"text-gray-400 cursor-pointer hover:bg-red-50"),children:l?a:"—"},`${s}-${r.key}`)})]},s))})]})})]})});J.displayName="SellerQuoteComparisonTable";let X=(0,r.memo)(()=>{let e,s,{session:a,aiSuggestions:i,setAiSuggestions:c,selectedSuggestions:d,setFullContextCompletion:p,setShowAIPanel:g,getRoomPlatform:f,addBuyerMessage:y}=(0,E.useDealModal)(),_=a?.session_id||"",A=(0,F.default)(e=>e.sellerContextsBySession),I=_?A.get(_):void 0,T=e=>I?.[e]||a?.seller_contexts?.[e],[O,P]=(0,r.useState)(!1),[U,B]=(0,r.useState)("quote-history"),[z,L]=(0,r.useState)(null),[W,H]=(0,r.useState)(""),[K,X]=(0,r.useState)(0),[Y,Q]=(0,r.useState)(!1),[G,Z]=(0,r.useState)(new Map),[ee,et]=(0,r.useState)([]),[es,er]=(0,r.useState)([]),[ea,el]=(0,r.useState)("3m"),[en,ei]=(0,r.useState)([]),[eo,ec]=(0,r.useState)(!1),[ed,eu]=(0,r.useState)([]),[em,ep]=(0,r.useState)(!1),[eg,ex]=(0,r.useState)([]),[eh,ef]=(0,r.useState)(!1),[ey,e_]=(0,r.useState)(null),[eb,ev]=(0,r.useState)([]),[ej,eN]=(0,r.useState)(!1),[ew,ek]=(0,r.useState)(new Set),eS=(e,t)=>`${e}-${t}`;(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch(`${(0,R.getApiUrl)()}/api/traders/all`);if(e.ok){let t=await e.json();et(t)}}catch(e){console.error("Failed to fetch all traders:",e)}})()},[]),(0,r.useEffect)(()=>{a&&(0!==i.length||W||H(((e="ko")=>{if(!a)return"";let{vessel_name:t,port:s,delivery_date:r,fuel_type:l,quantity:n,fuel_type2:i,quantity2:o,imo:c}=a,d=e=>e?e.toUpperCase().includes("MT")?e:`${e}MT`:"";if("en"===e){let e=`${t||"TBD"}${c?` (IMO: ${c})`:""}
`;return e+=`${s||"TBD"}
${r||"TBD"}
${l||"TBD"} ${d(n)}
`,i&&(e+=`${i} ${d(o)}
`),e+=`
Please advise earliest and price. Thank you!`}{let e=`${t||"TBD"}${c?` (IMO: ${c})`:""}
`;return e+=`${s||"TBD"}
${r||"TBD"}
${l||"TBD"} ${d(n)}
`,i&&(e+=`${i} ${d(o)}
`),e+=`
상기 건 얼리 및 가격 확인 부탁드립니다. 감사합니다!`}})("ko")))},[a,i.length]);let eC=async e=>{if(a?.port&&a?.fuel_type){ec(!0);try{let t=`${(0,R.getApiUrl)()}/api/price-trends?port=${encodeURIComponent(a.port)}&fuel_type=${encodeURIComponent(a.fuel_type)}&period=${e}`;a.fuel_type2&&(t+=`&fuel_type2=${encodeURIComponent(a.fuel_type2)}`);let s=await fetch(t);if(s.ok){let e=await s.json();ei(e.fuel_types||[])}}catch(e){console.error("Failed to fetch price trends:",e),ei([])}finally{ec(!1)}}};(0,r.useEffect)(()=>{"price-trends"===U&&a?.port&&a?.fuel_type&&eC(ea)},[U,ea,a?.port,a?.fuel_type,a?.fuel_type2]);let eq=async()=>{if(a?.session_id){ep(!0);try{let e=await fetch(`${(0,R.getApiUrl)()}/sessions/${a.session_id}/quote-history`);if(e.ok){let t=await e.json();eu(t.history||[])}}catch(e){console.error("Failed to fetch quote history:",e),eu([])}finally{ep(!1)}}};(0,r.useEffect)(()=>{"quote-history"===U&&a?.session_id&&eq()},[U,a?.session_id]);let e$=async()=>{if(a?.customer_room_name){ef(!0);try{let e=await fetch(`${(0,R.getApiUrl)()}/customers/${encodeURIComponent(a.customer_room_name)}/vessels`);if(e.ok){let t=await e.json();ex(t.vessels||[]),a.vessel_name&&t.vessels?.some(e=>e.vessel_name===a.vessel_name)?e_(a.vessel_name):t.vessels?.length>0&&e_(t.vessels[0].vessel_name)}}catch(e){console.error("Failed to fetch buyer vessels:",e),ex([])}finally{ef(!1)}}},eD=async e=>{if(a?.customer_room_name&&e){eN(!0);try{let t=await fetch(`${(0,R.getApiUrl)()}/customers/${encodeURIComponent(a.customer_room_name)}/vessels/${encodeURIComponent(e)}/history`);if(t.ok){let e=await t.json();ev(e.history||[])}}catch(e){console.error("Failed to fetch inquiry history:",e),ev([])}finally{eN(!1)}}};(0,r.useEffect)(()=>{"buyer-info"===U&&a?.customer_room_name&&e$()},[U,a?.customer_room_name]),(0,r.useEffect)(()=>{"buyer-info"===U&&ey&&eD(ey)},[U,ey]);let eM=async(e,t="ko")=>{if(a?.session_id&&!ew.has(e)){ek(t=>new Set(t).add(e));try{(await fetch(`${(0,R.getApiUrl)()}/api/reminder/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:a.session_id,trader_room_name:e,language:t})})).ok&&console.log("[Reminder] Sent successfully to",e)}catch(e){console.error("Failed to send reminder:",e)}finally{ek(t=>{let s=new Set(t);return s.delete(e),s})}}},eA=(e,t)=>e.some(e=>("string"==typeof e?e:e.room)===t);(0,r.useEffect)(()=>{if(i.length>0&&null===z){let e=i[0];L(e.id),H(e.suggestions[0]?.message||""),e.suggestions[0]?.targets&&((e,t,s)=>{let r=eS(e,0);if(!G.has(r)){let e=new Set(s.map(e=>"string"==typeof e?e:e.room));Z(t=>new Map(t).set(r,e))}})(e.id,0,e.suggestions[0].targets)}},[i,z]);let eE=["vessel_name","port","delivery_date","fuel_type","quantity"],eI=a?.fuel_type2?[...eE,"fuel_type2","quantity2"]:eE,eT=eI.filter(e=>{if(!a)return!0;let t=a[e];return!t||""===t}),eF=Math.round((eI.length-eT.length)/eI.length*100);(0,r.useEffect)(()=>{p(eF)},[eF,p]),(0,r.useEffect)(()=>{if(!a)return;let e=async()=>{try{let e=await fetch(`${(0,R.getApiUrl)()}/ai-suggestions/session/${a.session_id}`);if(e.ok){let t=await e.json(),s=Array.isArray(t)?t:[];c(s)}}catch(e){console.error("Failed to fetch AI suggestions:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[a,c]);let eR=async(e,t,s)=>{if(console.log("[AI Approve] START - suggestion:",e.id,"optionIndex:",t,"isProcessing:",Y,"hasSession:",!!a),!a||Y)return void console.log("[AI Approve] EARLY RETURN - session:",!!a,"isProcessing:",Y);Q(!0);try{var r;let l,n=e.suggestions[t];if(!n)return void console.log("[AI Approve] No option found at index:",t);let i=s||n.message,o=(r=e.id,l=eS(r,t),Array.from(G.get(l)||[]));console.log("[AI Approve] selectedRooms:",o,"optionIndex:",t);let c={selected_options:[t+1],modified_message:s||null,selected_targets:{[String(t+1)]:o}};if(console.log("[AI Approve] Sending payload:",JSON.stringify(c,null,2)),await fetch(`${(0,R.getApiUrl)()}/ai-suggestions/approve?suggestion_id=${e.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),"reply_to_customer"===n.action&&i){let e=f(a.customer_room_name),t={message_id:Date.now(),room_name:a.customer_room_name,sender:"Harold",message:i,timestamp:new Date().toISOString(),package_name:e,direction:"outgoing",created_at:new Date().toISOString()};y(t)}let d=eS(e.id,t);Z(e=>{let t=new Map(e);return t.delete(d),t}),console.log(`[Inquiry Sender] Message sent to ${o.length} traders`)}catch(e){console.error("Failed to approve suggestion:",e)}finally{Q(!1)}};return(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"p-3 border-b bg-gray-50 flex items-center justify-between",children:[(0,t.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,t.jsx)(h.Sparkles,{className:"w-4 h-4"}),"AI Assistant"]}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>g(!1),className:"h-8 w-8 p-0 bg-white hover:bg-red-50 hover:text-red-600 hover:border-red-300 border-gray-300",children:(0,t.jsx)(u.X,{className:"w-4 h-4"})})]}),(0,t.jsx)(l.ScrollArea,{className:"flex-1 p-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(J,{}),!1,(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex border-b",children:[(0,t.jsxs)("button",{onClick:()=>B("quote-history"),className:(0,D.cn)("flex-1 px-3 py-2 text-sm font-medium transition-colors border-b-2 flex items-center justify-center gap-1","quote-history"===U?"text-purple-600 border-purple-500 bg-purple-50":"text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-50"),children:[(0,t.jsx)(x.MessageSquare,{className:"w-4 h-4"}),"Quote History"]}),a?.port&&a?.fuel_type&&(0,t.jsxs)("button",{onClick:()=>B("price-trends"),className:(0,D.cn)("flex-1 px-3 py-2 text-sm font-medium transition-colors border-b-2 flex items-center justify-center gap-1","price-trends"===U?"text-green-600 border-green-500 bg-green-50":"text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-50"),children:[(0,t.jsx)(b.TrendingUp,{className:"w-4 h-4"}),"Price Trends"]}),(0,t.jsx)("button",{onClick:()=>B("inquiry"),className:(0,D.cn)("flex-1 px-3 py-2 text-sm font-medium transition-colors border-b-2","inquiry"===U?"text-blue-600 border-blue-500 bg-blue-50":"text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-50"),children:"Inquiry Sender"}),(0,t.jsxs)("button",{onClick:()=>B("buyer-info"),className:(0,D.cn)("flex-1 px-3 py-2 text-sm font-medium transition-colors border-b-2 flex items-center justify-center gap-1","buyer-info"===U?"text-orange-600 border-orange-500 bg-orange-50":"text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-50"),children:[(0,t.jsx)(j.Ship,{className:"w-4 h-4"}),"Buyer Info"]})]}),"inquiry"===U&&(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,t.jsxs)("div",{className:"p-3 bg-gray-50 space-y-3",children:[ee.length>0&&(0,t.jsxs)("div",{className:"border rounded-lg bg-white",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b bg-gray-50",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Select Recipients"}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("button",{onClick:()=>{Z(new Map([["inquiry",new Set(ee.map(e=>e.room_name))]]))},className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"All"}),(0,t.jsx)("button",{onClick:()=>{Z(new Map([["inquiry",new Set]]))},className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors",children:"None"})]})]}),(0,t.jsx)("div",{className:"p-2 space-y-1",children:(e=i[i.length-1],s=e?.suggestions?.[0]?.targets||[],[...ee].sort((e,t)=>{let r=eA(s,e.room_name),a=eA(s,t.room_name);return r&&!a?-1:!r&&a?1:0}).map(e=>{let r=(G.get("inquiry")||new Set).has(e.room_name),a=eA(s,e.room_name),l=T(e.room_name),n=!!l?.contacted_at,i=(e=>{if(!e)return null;try{return(0,M.formatDistanceToNow)(new Date(e),{addSuffix:!0})}catch{return null}})(l?.contacted_at);return(0,t.jsxs)("div",{className:(0,D.cn)("flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer text-xs transition-colors",n?"bg-gray-100 border border-gray-200":r?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-transparent hover:bg-gray-100"),onClick:()=>{let t=new Set(G.get("inquiry")||new Set);t.has(e.room_name)?t.delete(e.room_name):t.add(e.room_name),Z(new Map([["inquiry",t]]))},children:[(0,t.jsx)("div",{className:(0,D.cn)("w-4 h-4 rounded border flex items-center justify-center flex-shrink-0",r?"bg-blue-500 border-blue-500":"bg-white border-gray-300"),children:r&&(0,t.jsx)(m.CheckCircle2,{className:"w-3 h-3 text-white"})}),(0,t.jsx)("span",{className:(0,D.cn)("truncate flex-1",n?"text-gray-500":r?"text-blue-900 font-medium":"text-gray-700"),children:e.room_name}),n&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.Badge,{variant:"secondary",className:"text-[9px] px-1 py-0 bg-blue-100 text-blue-700 border-blue-200",children:"Sent"}),i&&(0,t.jsx)("span",{className:"text-[9px] text-gray-400",children:i}),(0,t.jsx)("button",{onClick:t=>{var s;let r;t.stopPropagation(),eM(e.room_name,(s=e.room_name,r=ee.find(e=>e.room_name===s),r?.language||"ko"))},disabled:ew.has(e.room_name),className:(0,D.cn)("p-0.5 rounded hover:bg-orange-100 transition-colors",ew.has(e.room_name)&&"opacity-50 cursor-not-allowed"),title:"리마인더 발송",children:(0,t.jsx)(v.Bell,{className:(0,D.cn)("w-3 h-3",ew.has(e.room_name)?"text-gray-400 animate-pulse":"text-orange-500")})})]}),a&&!n&&(0,t.jsx)(o.Badge,{variant:"secondary",className:"text-[9px] px-1 py-0 bg-green-100 text-green-700 border-green-200",children:"추천"})]},e.id)}))}),(0,t.jsxs)("div",{className:"px-3 py-2 bg-gray-50 text-xs text-gray-600",children:[G.get("inquiry")?.size||0," of ",ee.length," selected"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-700",children:"Edit Message"}),(0,t.jsx)("textarea",{value:W,onChange:e=>H(e.target.value),className:"w-full mt-1 p-2 text-xs border rounded resize-none bg-white",rows:4,placeholder:"메시지를 입력하세요..."})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(n.Button,{size:"sm",className:"flex-1",onClick:async()=>{console.log("[Inquiry Sender] Send button clicked");let e=G.get("inquiry")||new Set;if(console.log("[Inquiry Sender] Selected rooms:",Array.from(e),"message:",W),0===e.size||!W.trim())return void console.log("[Inquiry Sender] Validation failed - no rooms or no message");Q(!0);try{for(let t of(console.log("[Inquiry Sender] Sending to",e.size,"traders"),e)){let e=ee.find(e=>e.room_name===t);e&&await fetch(`${(0,R.getApiUrl)()}/api/outgoing/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_name:t,message:W,package_name:e.platform||"com.kakao.talk",session_id:a?.session_id})})}Z(new Map([["inquiry",new Set]])),H("")}catch(e){console.error("Failed to send inquiry:",e)}finally{Q(!1)}},disabled:Y||!W.trim()||0===(G.get("inquiry")?.size||0),children:Y?"Sending...":"Send"})})]})}),"price-trends"===U&&a?.port&&a?.fuel_type&&(0,t.jsxs)("div",{className:"space-y-3 border rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Period:"}),(0,t.jsx)("div",{className:"flex gap-1",children:["3m","6m","1y"].map(e=>(0,t.jsx)("button",{onClick:()=>el(e),className:(0,D.cn)("px-2 py-1 text-xs rounded transition-colors",ea===e?"bg-green-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.toUpperCase()},e))}),(0,t.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:[a.port," / ",a.fuel_type,a.fuel_type2?` + ${a.fuel_type2}`:""]})]}),eo?(0,t.jsx)("div",{className:"h-48 flex items-center justify-center text-gray-500 text-sm border rounded-lg",children:"Loading..."}):en.length>0?(0,t.jsx)("div",{className:"space-y-4",children:en.map((e,s)=>(0,t.jsxs)("div",{className:"border rounded-lg p-3 bg-white",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-600 mb-2 flex items-center gap-2",children:[(0,t.jsx)("span",{className:`w-3 h-3 rounded-full ${0===s?"bg-green-500":"bg-blue-500"}`}),e.fuel_type,(0,t.jsxs)("span",{className:"text-gray-400",children:["(",e.trends.length," months)"]})]}),e.trends.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-36",children:(0,t.jsx)($.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(N.LineChart,{data:e.trends,margin:{top:5,right:20,bottom:5,left:0},children:[(0,t.jsx)(C.CartesianGrid,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,t.jsx)(k.XAxis,{dataKey:"date",tick:{fontSize:10},tickFormatter:e=>e.substring(5)}),(0,t.jsx)(S.YAxis,{tick:{fontSize:10},domain:["auto","auto"],tickFormatter:e=>`$${e}`}),(0,t.jsx)(q.Tooltip,{formatter:e=>[`$${e?.toFixed(2)}`,"Avg Price"],labelFormatter:e=>`Month: ${e}`,contentStyle:{fontSize:12}}),(0,t.jsx)(w.Line,{type:"monotone",dataKey:"avg_price",stroke:0===s?"#22c55e":"#3b82f6",strokeWidth:2,dot:{fill:0===s?"#22c55e":"#3b82f6",r:3},activeDot:{r:5}})]})})}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs mt-2",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded p-1.5 text-center",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"Latest"}),(0,t.jsxs)("div",{className:"font-medium",children:["$",e.trends[e.trends.length-1]?.avg_price?.toFixed(2)||"-"]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded p-1.5 text-center",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"Min"}),(0,t.jsxs)("div",{className:"font-medium",children:["$",Math.min(...e.trends.filter(e=>e.avg_price).map(e=>e.avg_price)).toFixed(2)||"-"]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded p-1.5 text-center",children:[(0,t.jsx)("div",{className:"text-gray-500",children:"Max"}),(0,t.jsxs)("div",{className:"font-medium",children:["$",Math.max(...e.trends.filter(e=>e.avg_price).map(e=>e.avg_price)).toFixed(2)||"-"]})]})]})]}):(0,t.jsxs)("div",{className:"h-20 flex items-center justify-center text-gray-400 text-xs",children:["No data for ",e.fuel_type]})]},e.fuel_type))}):(0,t.jsx)("div",{className:"h-48 flex items-center justify-center text-gray-500 text-sm border rounded-lg",children:"No price data available for this port/fuel combination"})]}),"quote-history"===U&&(0,t.jsxs)("div",{className:"space-y-3 border rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"Price Negotiation History"}),(0,t.jsx)("button",{onClick:eq,className:"text-xs text-purple-600 hover:text-purple-800",children:"Refresh"})]}),em?(0,t.jsx)("div",{className:"h-48 flex items-center justify-center text-gray-500 text-sm",children:"Loading..."}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(()=>{let e=I?Object.keys(I):a?.seller_contexts?Object.keys(a.seller_contexts):a?.requested_traders||[],s=ed.reduce((e,t)=>{let s=t.trader_room_name;return e[s]||(e[s]=[]),e[s].push(t),e},{});Object.keys(s).forEach(e=>{s[e].sort((e,t)=>new Date(e.quoted_at).getTime()-new Date(t.quoted_at).getTime())});let r=Math.max(...Object.values(s).map(e=>e.length),1);if(0===e.length)return(0,t.jsx)("div",{className:"h-32 flex items-center justify-center text-gray-500 text-sm border rounded-lg",children:"No sellers requested yet"});let l=e=>{if(!e||!e.price)return"—";let t=e.price.toFixed(0),s=T(e.trader_room_name),r=s?.quote?.fuel2_price;if(r){let e=parseFloat(r.replace(/[^\d.]/g,""));isNaN(e)||(t+=`/${e.toFixed(0)}`)}return e.barge_fee&&(t+=`+${e.barge_fee.toFixed(0)}`),t};return(0,t.jsxs)("table",{className:"w-full text-[10px]",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-purple-50 border-b",children:[(0,t.jsx)("th",{className:"px-2 py-1.5 text-left font-medium text-purple-700 sticky left-0 bg-purple-50 min-w-[100px]",children:"Seller"}),Array.from({length:r},(e,s)=>(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-purple-700 min-w-[70px]",children:0===s?"1st":1===s?"2nd":2===s?"3rd":`${s+1}th`},s)),(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-green-700 bg-green-50 min-w-[70px]",children:"Final"}),(0,t.jsx)("th",{className:"px-2 py-1.5 text-center font-medium text-gray-600 min-w-[50px]",children:"Δ"})]})}),(0,t.jsx)("tbody",{children:e.map(e=>{let a=s[e]||[],n=a.length>0,i=T(e),o=i?.status||"waiting_quote",c=a[0]?.price,d=a[a.length-1]?.price,u=n&&c&&d?d-c:null;return(0,t.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-2 py-1.5 text-left font-medium text-gray-700 sticky left-0 bg-white truncate",title:e,children:(e=>{if(e.length<=12)return e;let t=e.match(/\(([^)]+)\)/);return t?t[1]:e.slice(0,10)+".."})(e)}),Array.from({length:r},(e,s)=>{let r=a[s],n=(()=>{if(!r||!i?.quote)return null;let e=i.quote,t=e.fuel1_margin,s=e.fuel2_margin;if(!t&&!s)return null;try{let a=r.price||0,l=parseFloat((t||"0").replace(/[^\d.]/g,"")),n=(a+l).toFixed(0),i=e.fuel2_price;if(i&&s){let e=parseFloat(i.replace(/[^\d.]/g,"")),t=parseFloat(s.replace(/[^\d.]/g,""));n+=`/${(e+t).toFixed(0)}`}return r.barge_fee&&(n+=`+${r.barge_fee.toFixed(0)}`),n}catch{return null}})();return(0,t.jsx)("td",{className:"px-2 py-1.5 text-center",children:r?(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsx)("span",{className:"text-green-700 text-[10px]",children:l(r)}),n&&(0,t.jsxs)("span",{className:"text-blue-600 text-[9px]",children:["→ ",n]})]}):(0,t.jsx)("span",{className:"text-gray-300",children:"—"})},s)}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-center bg-green-50",children:n?(0,t.jsx)("span",{className:"font-bold text-green-700",children:l(a[a.length-1])}):(0,t.jsx)("span",{className:(0,D.cn)("text-[9px] px-1.5 py-0.5 rounded","waiting_quote"===o?"bg-yellow-100 text-yellow-700":"no_offer"===o?"bg-red-100 text-red-700":"bg-gray-100 text-gray-500"),children:"waiting_quote"===o?"Waiting":"no_offer"===o?"No Offer":"—"})}),(0,t.jsx)("td",{className:"px-2 py-1.5 text-center",children:null!==u&&0!==u?(0,t.jsxs)("span",{className:(0,D.cn)("text-[9px] font-medium",u<0?"text-green-600":"text-red-600"),children:[u<0?"↓":"↑",Math.abs(u).toFixed(0)]}):(0,t.jsx)("span",{className:"text-gray-300",children:"—"})})]},e)})})]})})()})]}),"buyer-info"===U&&(0,t.jsxs)("div",{className:"space-y-4 border rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:[a?.customer_room_name||"Buyer"," - Vessels & Inquiry History"]}),(0,t.jsxs)("span",{className:"text-[10px] text-gray-400",children:[eg.length," vessels"]})]}),eh?(0,t.jsx)("div",{className:"h-32 flex items-center justify-center text-gray-500 text-sm",children:"Loading vessels..."}):0===eg.length?(0,t.jsx)("div",{className:"h-32 flex items-center justify-center text-gray-500 text-sm",children:"No vessel data found"}):(0,t.jsx)("div",{className:"space-y-4",children:eg.map(e=>{let s=e.vessel_name===a?.vessel_name;return(0,t.jsxs)("div",{className:(0,D.cn)("border rounded-lg overflow-hidden",s&&"ring-2 ring-orange-400"),children:[(0,t.jsxs)("div",{className:(0,D.cn)("px-3 py-2 flex items-center justify-between",s?"bg-orange-100":"bg-gray-50"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.Ship,{className:(0,D.cn)("w-4 h-4",s?"text-orange-600":"text-gray-500")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:(0,D.cn)("font-medium text-sm",s?"text-orange-800":"text-gray-700"),children:e.vessel_name}),s&&(0,t.jsx)("span",{className:"ml-2 text-[10px] bg-orange-500 text-white px-1.5 py-0.5 rounded",children:"Current"})]})]}),(0,t.jsxs)("div",{className:"text-[10px] text-gray-500",children:[e.imo&&(0,t.jsxs)("span",{className:"mr-2",children:["IMO: ",e.imo]}),(0,t.jsxs)("span",{children:[e.inquiry_count," inquiries"]})]})]}),(0,t.jsx)(V,{customerRoom:a?.customer_room_name||"",vesselName:e.vessel_name,currentSessionId:a?.session_id})]},e.vessel_name)})})]})]})]})}),d.size>0&&(0,t.jsx)("div",{className:"p-3 border-t bg-gray-50",children:(0,t.jsxs)(n.Button,{className:"w-full",size:"sm",onClick:()=>{i.filter(e=>d.has(e.id)).forEach(e=>eR(e,0))},disabled:Y,children:["Apply Selected (",d.size,")"]})})]})});X.displayName="AIAssistantColumn";let Y={waiting_quote:{label:"Waiting",color:"bg-yellow-100 text-yellow-800"},quote_received:{label:"Quoted",color:"bg-green-100 text-green-800"},no_offer:{label:"No Offer",color:"bg-gray-100 text-gray-600"},renegotiating:{label:"Renegotiating",color:"bg-blue-100 text-blue-800"},negotiating:{label:"Negotiating",color:"bg-purple-100 text-purple-800"}},Q=(0,r.memo)(()=>{let{session:e,activeSellerTab:s,setActiveSellerTab:a,sellerTabs:l,addSellerTab:n,sellerMessages:i,setSellerMessagesForTrader:c,addSellerMessage:d,getRoomPlatform:u,roomPlatforms:m}=(0,E.useDealModal)(),p=e?.session_id||"",g=(0,F.default)(e=>e.sellerContextsBySession),h=(0,F.default)(e=>e.unreadCountsBySession),f=(0,F.default)(e=>e.updateSellerContext),y=(0,F.default)(e=>e.clearUnread),_=p?g.get(p):void 0,b=p&&h.get(p)||{},v=t=>_?.[t]||e?.seller_contexts?.[t],[j,N]=(0,r.useState)({}),w=(0,r.useRef)(!1),[k,S]=(0,r.useState)(null),C=(0,r.useRef)(s),q=(0,r.useRef)(p);(0,r.useEffect)(()=>{C.current=s},[s]),(0,r.useEffect)(()=>{q.current=p},[p]),(0,r.useEffect)(()=>{s&&p&&b[s]>0&&y(p,s)},[s,p,b,y]);let $=async(t,s,r)=>{if(e?.session_id)try{let a={};s.includes("price")||"barge_fee"===s?(a.quote={...e.seller_contexts?.[t]?.quote||{},[s]:r},r&&(a.status="quote_received")):"earliest"===s?a.earliest=r:"no_offer_reason"===s?(a.no_offer_reason=r,a.status="no_offer"):"status"===s&&(a.status=r);let l=await fetch(`${(0,R.getApiUrl)()}/sessions/${e.session_id}/seller-context/${encodeURIComponent(t)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(l.ok){console.log(`seller_context 업데이트 성공: ${t}.${s} = ${r}`);let a={..._?.[t]||e?.seller_contexts?.[t]||{status:"waiting_quote",quote:null}};"status"===s?a.status=r:s.includes("price")||"barge_fee"===s?(a.quote={...a.quote||{},[s]:r},r&&(a.status="quote_received")):"earliest"===s?a.earliest=r:"no_offer_reason"===s&&(a.no_offer_reason=r,a.status="no_offer"),p&&f(p,t,a)}else console.error("seller_context 업데이트 실패:",await l.text())}catch(e){console.error("seller_context 업데이트 오류:",e)}};(0,r.useEffect)(()=>{let t=e?.seller_contexts?Object.keys(e.seller_contexts):e?.requested_traders||[];t.length&&0!==m.size&&!w.current&&(w.current=!0,t.forEach(e=>{n(e);let t=u(e);(async()=>{try{let s=await fetch(`${(0,R.getApiUrl)()}/chats/${encodeURIComponent(e)}/messages?platform=${t}`);if(s.ok){let r=await s.json(),a=Array.isArray(r)?r:r.data||[],l=["Harold","씨너지파트너","Seanergy","seanergyAI","SeanergyAI","김성원","김민석","권예정","Yong","Kenn","Me","나"],n=a.map(e=>({message_id:e.id||e.message_id,room_name:e.room_name,sender:e.sender,message:e.message,timestamp:e.created_at,package_name:e.platform||t,direction:e.direction||(l.some(t=>e.sender?.includes(t))?"outgoing":"incoming"),created_at:e.created_at,reply_to_message:e.reply_to_message,reply_to_author:e.reply_to_author}));c(e,n);try{let s={"com.kakao.talk":"kakao","com.kakao.yellowid":"kakao_biz","com.whatsapp":"whatsapp","com.wechat":"wechat"}[t]||"kakao";await fetch(`${(0,R.getApiUrl)()}/chats/${encodeURIComponent(e)}/mark-read?platform=${s}`,{method:"POST"})}catch(t){console.error(`Failed to mark seller messages as read for ${e}:`,t)}}}catch(t){console.error(`Failed to fetch messages for ${e}:`,t)}})()}))},[e?.session_id,m.size]),(0,r.useEffect)(()=>{if(!l.length||!e)return;let t=T.default.getInstance(),s=[];return l.forEach(e=>{let r=t.subscribe(e,t=>{d(e,t),e!==C.current&&"outgoing"!==t.direction&&q.current&&F.default.getState().incrementUnread(q.current,e)});s.push(r)}),()=>{s.forEach(e=>e())}},[l,e,d]);let M=async t=>{let s=j[t]||"";if(!s.trim()||!e)return;let r=u(t),a={"com.kakao.talk":"kakao","com.kakao.yellowid":"kakao_biz","com.whatsapp":"whatsapp","com.wechat":"wechat"}[r]||"kakao",l={message_id:Date.now(),room_name:t,sender:"Harold",message:s,timestamp:new Date().toISOString(),package_name:r,direction:"outgoing",created_at:new Date().toISOString()};d(t,l),N(e=>({...e,[t]:""}));try{await fetch(`${(0,R.getApiUrl)()}/messages/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_name:t,message:s,platform:a})})}catch(e){console.error("Failed to send message:",e)}};return(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"p-2 border-b bg-white flex-shrink-0",children:(0,t.jsxs)("h3",{className:"font-semibold flex items-center gap-2 text-sm",children:[(0,t.jsx)(x.MessageSquare,{className:"w-4 h-4"}),"Seller Chats",l.length>0&&(0,t.jsx)(o.Badge,{variant:"secondary",className:"ml-auto text-xs",children:l.length})]})}),0===l.length?(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:"No connected sellers"}):(0,t.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0 border-b bg-gray-50 overflow-y-auto",style:{height:"30%"},children:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-1 p-2",children:l.map(r=>{let l=_?.[r]?.status||e?.seller_contexts?.[r]?.status||"waiting_quote",n=Y[l],i=s===r,o=v(r),c=(0,A.getSellerRequiredFields)(e?.stage||"quote_collecting",e?.fuel_type2?2:1,o),d=(0,A.getFieldCompletionRatio)(c);return(0,t.jsx)("div",{onClick:()=>a(r),className:(0,D.cn)("relative cursor-pointer rounded-lg p-2 transition-all","border-2",i?"border-blue-500 bg-blue-50 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"),children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-gray-800 truncate",title:r,children:r.length>10?`${r.slice(0,10)}..`:r}),b[r]>0&&(0,t.jsx)("span",{className:"ml-1 px-1.5 py-0.5 text-[9px] font-bold bg-red-500 text-white rounded-full animate-pulse min-w-[18px] text-center",children:b[r]>99?"99+":b[r]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:["no_offer"!==l&&(0,t.jsxs)("span",{className:(0,D.cn)("text-[9px] px-1 py-0.5 rounded",100===d.percentage?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"),children:[d.filled,"/",d.total]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:e=>{e.stopPropagation(),S(k===r?null:r)},className:(0,D.cn)("text-[9px] px-1.5 py-0.5 rounded-full whitespace-nowrap flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity",n.color),children:[n.label," ▾"]}),k===r&&(0,t.jsx)("div",{className:"absolute right-0 top-full mt-1 z-50 bg-white border rounded-lg shadow-lg py-1 min-w-[120px]",children:Object.entries(Y).map(([e,s])=>(0,t.jsxs)("button",{onClick:t=>{t.stopPropagation(),$(r,"status",e),S(null)},className:(0,D.cn)("w-full text-left px-3 py-1.5 text-[10px] hover:bg-gray-100 flex items-center gap-2",l===e&&"bg-gray-50 font-medium"),children:[(0,t.jsx)("span",{className:(0,D.cn)("w-2 h-2 rounded-full","waiting_quote"===e&&"bg-yellow-400","quote_received"===e&&"bg-green-400","no_offer"===e&&"bg-gray-400","renegotiating"===e&&"bg-blue-400","negotiating"===e&&"bg-purple-400")}),s.label]},e))})]})]})]}),o?.quote&&(0,t.jsxs)("div",{className:"mt-1 text-[10px] text-gray-600 truncate",children:[o.quote.fuel1_price&&(0,t.jsx)("span",{className:"text-green-700",children:o.quote.fuel1_price}),o.quote.barge_fee&&(0,t.jsxs)("span",{className:"text-blue-600 ml-1",children:["+",o.quote.barge_fee]})]}),o?.no_offer_reason&&(0,t.jsx)("div",{className:"mt-1 text-[10px] text-red-500 truncate",children:o.no_offer_reason})]})},r)})})}),(0,t.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",style:{height:"70%"},children:s&&(0,t.jsx)(Z,{trader:s,messages:i.get(s)||[],inputValue:j[s]||"",onInputChange:e=>N(t=>({...t,[s]:e})),onSend:()=>M(s),sellerContext:v(s)},`${s}-${v(s)?.status||"unknown"}`)})]})]})});Q.displayName="SellerChatsColumn";let G=(0,r.memo)(e=>{let r,a,l,n,i,o,c,u,m,p,g,x=(0,s.c)(31),{message:h}=e,f="outgoing"===h.direction||"Harold"===h.sender,y=f&&"justify-end";x[0]!==y?(r=(0,D.cn)("flex gap-2",y),x[0]=y,x[1]=r):r=x[1],x[2]!==f?(a=!f&&(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:(0,t.jsx)(d.User,{className:"w-4 h-4"})}),x[2]=f,x[3]=a):a=x[3];let _=f?"bg-blue-500 text-white":"bg-gray-100 text-gray-900";x[4]!==_?(l=(0,D.cn)("max-w-[70%] rounded-lg px-3 py-2",_),x[4]=_,x[5]=l):l=x[5],x[6]!==f||x[7]!==h.reply_to_author||x[8]!==h.reply_to_message?(n=h.reply_to_message&&(0,t.jsxs)("div",{className:(0,D.cn)("mb-2 pl-2 border-l-2 text-xs",f?"border-blue-300 text-blue-100":"border-gray-300 text-gray-500"),children:[(0,t.jsx)("span",{className:"font-medium",children:h.reply_to_author||"알 수 없음"}),(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words",children:h.reply_to_message})]}),x[6]=f,x[7]=h.reply_to_author,x[8]=h.reply_to_message,x[9]=n):n=x[9],x[10]!==h.message?(i=(0,t.jsx)("div",{className:"text-sm",children:h.message}),x[10]=h.message,x[11]=i):i=x[11];let b=f?"text-blue-100":"text-gray-500";return x[12]!==b?(o=(0,D.cn)("text-xs mt-1",b),x[12]=b,x[13]=o):o=x[13],x[14]!==h.timestamp?(c=(0,M.formatDistanceToNow)(new Date(h.timestamp),{addSuffix:!0}),x[14]=h.timestamp,x[15]=c):c=x[15],x[16]!==c||x[17]!==o?(u=(0,t.jsx)("div",{className:o,children:c}),x[16]=c,x[17]=o,x[18]=u):u=x[18],x[19]!==u||x[20]!==l||x[21]!==n||x[22]!==i?(m=(0,t.jsxs)("div",{className:l,children:[n,i,u]}),x[19]=u,x[20]=l,x[21]=n,x[22]=i,x[23]=m):m=x[23],x[24]!==f?(p=f&&(0,t.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden flex items-center justify-center",children:(0,t.jsx)("img",{src:"/harold-mockup/SP_logo.png",alt:"Seanergy",className:"w-8 h-8 object-cover"})}),x[24]=f,x[25]=p):p=x[25],x[26]!==m||x[27]!==p||x[28]!==r||x[29]!==a?(g=(0,t.jsxs)("div",{className:r,children:[a,m,p]}),x[26]=m,x[27]=p,x[28]=r,x[29]=a,x[30]=g):g=x[30],g});G.displayName="MessageBubble",(0,r.memo)(e=>{let r,a,l,n,i,c,d,u,g,x=(0,s.c)(24),{suggestion:h,isSelected:f,onToggle:y}=e,_=h.suggestions?.[0],b=f?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300";return x[0]!==b?(r=(0,D.cn)("p-3 rounded-lg border cursor-pointer transition-all",b),x[0]=b,x[1]=r):r=x[1],x[2]!==f?(a=(0,t.jsx)("div",{className:"mt-1",children:f?(0,t.jsx)(m.CheckCircle2,{className:"w-4 h-4 text-blue-500"}):(0,t.jsx)(p.Circle,{className:"w-4 h-4 text-gray-400"})}),x[2]=f,x[3]=a):a=x[3],x[4]!==h.category?(l=(0,t.jsx)("div",{className:"font-medium text-sm",children:h.category}),x[4]=h.category,x[5]=l):l=x[5],x[6]!==h.original_message?(n=h.original_message&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1 bg-gray-100 p-2 rounded",children:[(0,t.jsxs)("span",{className:"font-medium",children:[h.original_message.sender,":"]})," ",h.original_message.message]}),x[6]=h.original_message,x[7]=n):n=x[7],x[8]!==_?(i=_&&(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-2",children:[(0,t.jsxs)("span",{className:"font-medium",children:[_.action,":"]})," ",_.reason,_.message&&(0,t.jsxs)("div",{className:"mt-1 text-blue-600",children:['"',_.message,'"']})]}),x[8]=_,x[9]=i):i=x[9],x[10]!==h.confidence?(c=h.confidence&&(0,t.jsxs)(o.Badge,{variant:h.confidence>.8?"default":"secondary",className:"mt-2",children:["Confidence: ",Math.round(100*h.confidence),"%"]}),x[10]=h.confidence,x[11]=c):c=x[11],x[12]!==l||x[13]!==n||x[14]!==i||x[15]!==c?(d=(0,t.jsxs)("div",{className:"flex-1",children:[l,n,i,c]}),x[12]=l,x[13]=n,x[14]=i,x[15]=c,x[16]=d):d=x[16],x[17]!==a||x[18]!==d?(u=(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[a,d]}),x[17]=a,x[18]=d,x[19]=u):u=x[19],x[20]!==y||x[21]!==r||x[22]!==u?(g=(0,t.jsx)("div",{className:r,onClick:y,children:u}),x[20]=y,x[21]=r,x[22]=u,x[23]=g):g=x[23],g}).displayName="SuggestionCard";let Z=(0,r.memo)(e=>{let a,o,d,u,m,p,x,h,f,y,_,b,v,j,N,w,k,S,C=(0,s.c)(43),{trader:q,messages:$,inputValue:D,onInputChange:M,onSend:A,sellerContext:E}=e,I=(0,r.useRef)(null),T=(0,r.useRef)(0);C[0]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{let e=I.current?.querySelector("[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)},C[0]=a):a=C[0];let F=a;C[1]!==$.length?(o=()=>{if($.length>0){let e=0===T.current&&$.length>0,t=$.length>T.current;(e||t)&&(F(),setTimeout(F,50),setTimeout(F,150)),T.current=$.length}},C[1]=$.length,C[2]=o):o=C[2],C[3]!==$?(d=[$],C[3]=$,C[4]=d):d=C[4],(0,r.useEffect)(o,d),C[5]!==$.length?(u=()=>{T.current=0,$.length>0&&(F(),setTimeout(F,50),setTimeout(F,150))},C[5]=$.length,C[6]=u):u=C[6],C[7]!==q?(m=[q],C[7]=q,C[8]=m):m=C[8],(0,r.useEffect)(u,m),C[9]!==E?(p=E?.no_offer_reason&&(0,t.jsx)("div",{className:"p-2 border-b bg-red-50 text-xs",children:(0,t.jsxs)("div",{className:"flex items-center gap-1 text-red-600",children:[(0,t.jsx)(g.AlertCircle,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"font-medium",children:"No Offer:"}),(0,t.jsx)("span",{children:E.no_offer_reason})]})}),C[9]=E,C[10]=p):p=C[10],C[11]!==$?(x=$.map(ee),C[11]=$,C[12]=x):x=C[12],C[13]!==x?(h=(0,t.jsx)(l.ScrollArea,{ref:I,className:"flex-1 min-h-0",children:(0,t.jsx)("div",{className:"p-4 space-y-3",children:x})}),C[13]=x,C[14]=h):h=C[14],C[15]!==M||C[16]!==A?(f=e=>{M(e),setTimeout(()=>A(),0)},C[15]=M,C[16]=A,C[17]=f):f=C[17],C[18]!==f||C[19]!==q?(y=(0,t.jsx)(B,{roomName:q,className:"pb-1",onSend:f}),C[18]=f,C[19]=q,C[20]=y):y=C[20],C[21]!==M?(_=e=>M(e.target.value),C[21]=M,C[22]=_):_=C[22],C[23]!==A?(b=e=>"Enter"===e.key&&A(),C[23]=A,C[24]=b):b=C[24];let R=`Message to ${q}...`;return C[25]!==D||C[26]!==_||C[27]!==b||C[28]!==R?(v=(0,t.jsx)(i.Input,{value:D,onChange:_,onKeyPress:b,placeholder:R,className:"flex-1"}),C[25]=D,C[26]=_,C[27]=b,C[28]=R,C[29]=v):v=C[29],C[30]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)(c.Send,{className:"w-4 h-4"}),C[30]=j):j=C[30],C[31]!==A?(N=(0,t.jsx)(n.Button,{onClick:A,size:"icon",children:j}),C[31]=A,C[32]=N):N=C[32],C[33]!==v||C[34]!==N?(w=(0,t.jsxs)("div",{className:"flex gap-2",children:[v,N]}),C[33]=v,C[34]=N,C[35]=w):w=C[35],C[36]!==y||C[37]!==w?(k=(0,t.jsxs)("div",{className:"p-3 border-t bg-white flex-shrink-0 space-y-2",children:[y,w]}),C[36]=y,C[37]=w,C[38]=k):k=C[38],C[39]!==k||C[40]!==p||C[41]!==h?(S=(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[p,h,k]}),C[39]=k,C[40]=p,C[41]=h,C[42]=S):S=C[42],S});function ee(e){return(0,t.jsx)(G,{message:e},e.message_id)}Z.displayName="SellerChatRoom",e.s(["DealDetailModal",()=>z],34920)}]);